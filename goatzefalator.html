<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D –°–∏–º—É–ª—è—Ç–æ—Ä –ö–æ–∑–ª–∞: ZEFAGOAT Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f0f0; }
        canvas { display: block; }
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: sans-serif;
            z-index: 10;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            max-width: 250px;
        }
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 24px;
            z-index: 999;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            background-color: #A0522D; /* –ö–æ–ª—ñ—Ä –∫–æ–∑–ª–∞ */
            color: white;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ZEFAGOAT...
        <p id="progress-status">0%</p>
        <p style="font-size: 14px;">(–ü–æ—Ç—Ä—ñ–±–µ–Ω –ª–æ–∫–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ .glb —Ç–∞ .png)</p>
    </div>

    <div id="ui" style="display: none;">
        <h2>üêê ZEFAGOAT WORLD</h2>
        <p>–ö–µ—Ä—É–≤–∞–Ω–Ω—è: –æ–±–µ—Ä—Ç–∞–Ω–Ω—è –º–∏—à–µ—é, —Å–∫—Ä–æ–ª –¥–ª—è –∑—É–º—É.</p>
        <div id="stats">–•–∞–æ—Å: 0</div>
        <button onclick="jumpGoat()">–°—Ç—Ä–∏–±–Ω—É—Ç–∏! (Space)</button>
        <button onclick="ramGoat()">–ë—É—Ü–Ω—É—Ç–∏!</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
    // --- 1. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –°—Ü–µ–Ω–∏ ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });

    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    renderer.setClearColor(0x87CEEB); // –ù–µ–±–æ

    // --- 2. –ì–ª–æ–±–∞–ª—å–Ω—ñ –ó–º—ñ–Ω–Ω—ñ ---
    let goatModel;
    let chaos = 0;
    let isJumping = false;
    let jumpVelocity = 0;
    const gravity = -0.05;
    const statsDisplay = document.getElementById('stats');
    const loadingScreen = document.getElementById('loading-screen');
    const progressStatus = document.getElementById('progress-status');
    const ui = document.getElementById('ui');

    // --- 3. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –†–µ—Å—É—Ä—Å—ñ–≤ ---

    // –¢–µ–∫—Å—Ç—É—Ä–∞ –¥–ª—è —Å–≤—ñ—Ç—É (goatzefalatorworldbox.png)
    const textureLoader = new THREE.TextureLoader();
    const worldTexture = textureLoader.load(
        'goatzefalatorworldbox.png',
        // on success
        () => console.log('–¢–µ–∫—Å—Ç—É—Ä–∞ —Å–≤—ñ—Ç—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞.'),
        // on progress
        (xhr) => { progressStatus.textContent = `–¢–µ–∫—Å—Ç—É—Ä–∞: ${Math.round(xhr.loaded / xhr.total * 50)}%`; },
        // on error
        (error) => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É—Ä–∏ —Å–≤—ñ—Ç—É:', error)
    );

    // GLTF Loader –¥–ª—è –º–æ–¥–µ–ª—ñ –∫–æ–∑–ª–∞ (zefagoat.glb)
    const gltfLoader = new THREE.GLTFLoader();

    gltfLoader.load(
        'zefagoat.glb',
        (gltf) => {
            goatModel = gltf.scene;
            goatModel.scale.set(1, 1, 1); // –ú–∞—Å—à—Ç–∞–±—É–π—Ç–µ, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
            goatModel.position.y = 0.5; // –ü—ñ–¥–Ω—ñ–º–∞—î–º–æ –Ω–∞–¥ –∑–µ–º–ª–µ—é
            scene.add(goatModel);

            // –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            loadingScreen.style.display = 'none';
            ui.style.display = 'block';
            camera.lookAt(goatModel.position);

            console.log('–ú–æ–¥–µ–ª—å –∫–æ–∑–ª–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ.');
        },
        // on progress
        (xhr) => { progressStatus.textContent = `–ú–æ–¥–µ–ª—å: ${50 + Math.round(xhr.loaded / xhr.total * 50)}%`; },
        // on error
        (error) => {
            console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ –∫–æ–∑–ª–∞:', error);
            progressStatus.textContent = '–ü–û–ú–ò–õ–ö–ê! –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ç–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Ñ–∞–π–ª—ñ–≤.';
        }
    );

    // --- 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –°–≤—ñ—Ç—É ---

    // –ó–µ–º–ª—è (–ü–ª–æ—â–∏–Ω–∞ –∑ —Ç–µ–∫—Å—Ç—É—Ä–æ—é –∞–±–æ –ø—Ä–æ—Å—Ç–∏–º –∫–æ–ª—å–æ—Ä–æ–º)
    const groundGeometry = new THREE.PlaneGeometry(30, 30);
    const groundMaterial = new THREE.MeshLambertMaterial({ map: worldTexture });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    // --- 5. –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è ---
    const ambientLight = new THREE.AmbientLight(0x404040, 2); // –ë—ñ–ª—å—à —è—Å–∫—Ä–∞–≤–µ –Ω–∞–≤–∫–æ–ª–∏—à–Ω—î —Å–≤—ñ—Ç–ª–æ
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 5).normalize();
    scene.add(directionalLight);

    // --- 6. –ö–∞–º–µ—Ä–∞ —Ç–∞ –ö–æ–Ω—Ç—Ä–æ–ª—å ---
    camera.position.set(5, 5, 5);
    camera.lookAt(0, 0, 0);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.target.set(0, 0.5, 0);
    controls.update();

    // --- 7. –õ–æ–≥—ñ–∫–∞ –Ü–≥—Ä–æ–≤–∏—Ö –î—ñ–π ---

    function updateChaos(amount) {
        chaos += amount;
        statsDisplay.textContent = `–•–∞–æ—Å: ${chaos}`;
    }

    // –î—ñ—è: –°—Ç—Ä–∏–±–æ–∫
    function jumpGoat() {
        if (!goatModel) return;
        if (!isJumping) {
            isJumping = true;
            jumpVelocity = 0.8;
            updateChaos(10);
            // –ù–µ–≤–µ–ª–∏–∫–∏–π –ø–æ–≤–æ—Ä–æ—Ç –¥–ª—è –¥–∏–Ω–∞–º—ñ–∫–∏
            goatModel.rotation.z = Math.PI / 12;
        }
    }

    // –î—ñ—è: –ë—É—Ü–Ω—É—Ç–∏
    function ramGoat() {
        if (!goatModel) return;
        updateChaos(25);
        // –®–≤–∏–¥–∫–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è "–±—É—Ü–∞–Ω–Ω—è" (–ø–æ–≤–æ—Ä–æ—Ç)
        const initialRotation = goatModel.rotation.y;
        const ramAngle = Math.PI / 8; // 22.5 –≥—Ä–∞–¥—É—Å—ñ–≤
        
        goatModel.rotation.y += ramAngle;
        setTimeout(() => {
            goatModel.rotation.y = initialRotation;
        }, 150);
    }

    // –û–±—Ä–æ–±–∫–∞ –∫–ª–∞–≤—ñ—à
    document.addEventListener('keydown', (event) => {
        if (event.code === 'Space') {
            jumpGoat();
        }
        if (event.code === 'KeyR') { // R –¥–ª—è Ram
            ramGoat();
        }
    });

    // --- 8. –ê–Ω—ñ–º–∞—Ü—ñ–π–Ω–∏–π –¶–∏–∫–ª (–†–µ–Ω–¥–µ—Ä–∏–Ω–≥) ---

    function animate() {
        requestAnimationFrame(animate);

        if (goatModel) {
            // –õ–æ–≥—ñ–∫–∞ –°—Ç—Ä–∏–±–∫–∞ (–§—ñ–∑–∏–∫–∞)
            if (isJumping) {
                jumpVelocity += gravity;
                goatModel.position.y += jumpVelocity;

                if (goatModel.position.y <= 0.5) {
                    goatModel.position.y = 0.5;
                    isJumping = false;
                    jumpVelocity = 0;
                    goatModel.rotation.z = 0; // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–∞–∑–∞–¥
                }
            }
        }

        controls.update();
        renderer.render(scene, camera);
    }

    animate();

    // --- 9. –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å (Resize) ---
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

</script>

</body>
</html>
