<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ó—î—Ñ–∞–ë—É—Ä–≥—î—Ä</title>
  <style>
    body { margin: 0; background: #222; color: #fff; font-family: sans-serif;}
    canvas { background: #8fd07f; display: block; margin: 0 auto; }
    #ui { position: absolute; top: 0; left: 0; right: 0; text-align: center; z-index: 10;}
    button { margin: 8px; padding: 12px 32px; font-size: 1.2em;}
  </style>
</head>
<body>
  <div id="ui"></div>
  <canvas id="game" width="900" height="600"></canvas>
  <script>
    // --- –ì–ª–æ–±–∞–ª—å–Ω—ñ ---
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const ui = document.getElementById('ui');
    let gameState = 'menu'; // 'menu', 'shop', 'kitchen', 'fight'
    let money = 100, health = 100, damage = 20, cookSpeed = 1.0;
    let ingredients = { bun: 2, patty: 2, lettuce: 2 };
    let burgers = 0;
    let chickenZefas = [];
    let projectiles = [];
    let player = { x: 450, y: 500, width: 50, height: 80, hp: 100, move: 0 };
    let fightTime = 0, fightTimer = 180, fightLevel = 1;
    let keys = {};
    let imgChicken = new Image(); imgChicken.src = 'zefaburgerchickenzefa.png';

    // --- Utils ---
    function drawButton(text, x, y, w, h, onclick) {
      ctx.fillStyle = "#fff";
      ctx.fillRect(x, y, w, h);
      ctx.fillStyle = "#222";
      ctx.font = "22px sans-serif";
      ctx.fillText(text, x + 20, y + h / 2 + 8);
      // –ù–µ–º–∞—î —Å–ø—Ä–∞–≤–∂–Ω—ñ—Ö –∫–Ω–æ–ø–æ–∫ –Ω–∞ canvas ‚Äî UI –≤ div
    }

    function rand(a, b) { return a + Math.random() * (b - a); }

    // --- –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é ---
    function showMenu() {
      ui.innerHTML = `
        <button onclick="setState('shop')">–ú–∞–≥–∞–∑</button>
        <button onclick="setState('kitchen')">–ö—É—Ö–Ω—è</button>
        <button onclick="setState('fight')">–î—Ä–∞–∫–∞</button>
        <div style='margin-top:12px'>üí∏ ${money} | üçî ${burgers} | ü•ó ${JSON.stringify(ingredients)}</div>
      `;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.font = "48px monospace";
      ctx.fillStyle = "#fff";
      ctx.fillText("–ó—î—Ñ–∞–ë—É—Ä–≥—î—Ä", 320, 150);
      ctx.font = "32px monospace";
      ctx.fillText("–ú–∞–≥–∞–∑ | –ö—É—Ö–Ω—è | –î—Ä–∞–∫–∞", 320, 220);
    }

    window.setState = function(state) {
      gameState = state;
      ui.innerHTML = '';
      if (state === 'menu') showMenu();
      if (state === 'shop') showShop();
      if (state === 'kitchen') showKitchen();
      if (state === 'fight') startFight();
    }

    // --- –ú–∞–≥–∞–∑ ---
    function showShop() {
      ui.innerHTML = `
        <button onclick="setState('menu')">‚Üê –ù–∞–∑–∞–¥</button>
        <div style='margin:12px'>üí∏ –ì—Ä–æ—à—ñ: ${money}</div>
        <div>
          <button onclick="buy('bun')">–ö—É–ø–∏—Ç–∏ –±—É–ª–∫—É (10)</button>
          <button onclick="buy('patty')">–ö—É–ø–∏—Ç–∏ –∫–æ—Ç–ª–µ—Ç—É (15)</button>
          <button onclick="buy('lettuce')">–ö—É–ø–∏—Ç–∏ —Å–∞–ª–∞—Ç (5)</button>
        </div>
        <div>
          <button onclick="upgrade('cookSpeed')">–®–≤–∏–¥–∫—ñ—Å—Ç—å –∫—É—Ö–Ω—ñ (+20)</button>
          <button onclick="upgrade('health')">–ó–¥–æ—Ä–æ–≤'—è (+30)</button>
          <button onclick="upgrade('damage')">–î–µ–º–µ–¥–∂ (+40)</button>
        </div>
        <div>üçî –Ü–Ω–≥—Ä–∞–¥—ñ—î–Ω—Ç–∏: ${JSON.stringify(ingredients)}</div>
        <div>üßë‚Äçüç≥ –®–≤–∏–¥–∫—ñ—Å—Ç—å: ${cookSpeed.toFixed(2)} | ‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤'—è: ${health} | ü•ä –î–µ–º–µ–¥–∂: ${damage}</div>
      `;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.font = "38px monospace";
      ctx.fillStyle = "#fff";
      ctx.fillText("–ú–ê–ì–ê–ó", 380, 120);
    }
    window.buy = function(type) {
      let price = { bun: 10, patty: 15, lettuce: 5 }[type];
      if (money >= price) {
        money -= price;
        ingredients[type]++;
        showShop();
      }
    }
    window.upgrade = function(type) {
      let price = { cookSpeed: 20, health: 30, damage: 40 }[type];
      if (money >= price) {
        money -= price;
        if (type === 'cookSpeed') cookSpeed += 0.2;
        if (type === 'health') health += 20;
        if (type === 'damage') damage += 5;
        showShop();
      }
    }

    // --- –ö—É—Ö–Ω—è ---
    function showKitchen() {
      ui.innerHTML = `
        <button onclick="setState('menu')">‚Üê –ù–∞–∑–∞–¥</button>
        <button onclick="makeBurger()">–ì–æ—Ç–æ–≤—ñ—Ç—å –±—É—Ä–≥–µ—Ä</button>
        <div>üçî –ë—É—Ä–≥–µ—Ä—ñ–≤: ${burgers}</div>
        <div>–Ü–Ω–≥—Ä–∞–¥—ñ—î–Ω—Ç–∏: ${JSON.stringify(ingredients)}</div>
      `;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.font = "38px monospace";
      ctx.fillStyle = "#fff";
      ctx.fillText("–ö–£–•–ù–Ø", 380, 120);
      ctx.font = "28px monospace";
      ctx.fillText("–ù–∞—Ç–∏—Å–Ω–∏, —â–æ–± –≥–æ—Ç—É–≤–∞—Ç–∏!", 300, 220);
    }
    window.makeBurger = function() {
      if (ingredients.bun > 0 && ingredients.patty > 0 && ingredients.lettuce > 0) {
        ingredients.bun--; ingredients.patty--; ingredients.lettuce--;
        burgers++;
        setTimeout(showKitchen, 1000 / cookSpeed); // —à–≤–∏–¥–∫—ñ—Å—Ç—å –≤–ø–ª–∏–≤–∞—î!
      }
    }

    // --- –î—Ä–∞–∫–∞ (2.5D) ---
    function startFight() {
      fightTime = 0; fightTimer = 180; fightLevel = 1;
      player.x = 450; player.hp = health;
      chickenZefas = [];
      projectiles = [];
      ui.innerHTML = `<button onclick="setState('menu')">‚Üê –í–∏–π—Ç–∏</button>
        <div>–ó–¥–æ—Ä–æ–≤'—è: <span id="hptxt">${player.hp}</span> | üçî: <span id="burgertxt">${burgers}</span></div>
        <div>–¢—Ä–∏–º–∞–π—Å—è 3 —Ö–≤–∏–ª–∏–Ω–∏! (–†—ñ–≤–µ–Ω—å <span id='lvltxt'>${fightLevel}</span>)</div>`;
      window.requestAnimationFrame(fightTick);
    }

    function fightTick(ts) {
      if (gameState !== 'fight') return;
      // update
      fightTime += 1 / 60;
      fightTimer -= 1 / 60;
      if (fightTime > fightLevel * 15) { fightLevel++; spawnZefas(); }
      if (fightTimer <= 0) {
        money += fightLevel * 50;
        ui.innerHTML = `<button onclick="setState('menu')">‚Üê –ù–∞–∑–∞–¥</button>
          <div><b>–ü–µ—Ä–µ–º–æ–≥–∞!</b> üí∏ +${fightLevel * 50}</div>`;
        return;
      }

      // –∫–µ—Ä—É–≤–∞–Ω–Ω—è
      if (keys['ArrowLeft']) player.x -= 8;
      if (keys['ArrowRight']) player.x += 8;
      player.x = Math.max(100, Math.min(800, player.x));

      // —Å—Ç—ñ–Ω–∏
      let wall1 = 120, wall2 = 780;
      if (player.x < wall1) player.x = wall1;
      if (player.x > wall2) player.x = wall2;

      // –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ß—ñ–∫—î–Ω–ó—î—Ñ
      for (let c of chickenZefas) {
        if (c.alive) {
          let dx = player.x - c.x;
          c.x += Math.sign(dx) * c.speed;
          if (Math.abs(c.x - player.x) < 40 && c.z < 40) {
            c.z = Math.max(0, c.z - 2);
            if (c.z <= 5) {
              player.hp -= 20;
              c.alive = false;
            }
          } else {
            c.z -= c.speed / 2;
            if (c.z < 0) c.z = 0;
          }
        }
      }

      // –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±—É—Ä–≥–µ—Ä—ñ–≤-–ø–æ—Å—Ç—Ä—ñ–ª—ñ–≤
      for (let p of projectiles) {
        p.z -= 15;
        if (p.z < 0) p.active = false;
        for (let c of chickenZefas) {
          if (c.alive && p.active && Math.abs(p.x - c.x) < 30 && Math.abs(p.z - c.z) < 20) {
            c.hp -= damage;
            p.active = false;
            if (c.hp <= 0) { c.alive = false; money += 10; }
          }
        }
      }
      projectiles = projectiles.filter(p => p.active);

      // –ø–æ—Ä–∞–∑–∫–∞
      if (player.hp <= 0) {
        ui.innerHTML = `<button onclick="setState('menu')">‚Üê –ù–∞–∑–∞–¥</button>
          <div><b>–¢–∏ –ø—Ä–æ–≥—Ä–∞–≤!</b></div>`;
        return;
      }
      // –º–∞–ª—é–≤–∞–Ω–Ω—è
      drawFight();
      // UI
      document.getElementById('hptxt').innerText = player.hp;
      document.getElementById('burgertxt').innerText = burgers;
      document.getElementById('lvltxt').innerText = fightLevel;
      // —Å–ø–∞–≤–Ω –ß—ñ–∫—î–Ω–ó—î—Ñ
      if (Math.random() < 0.02 * fightLevel && chickenZefas.length < fightLevel * 5) spawnZefas(1);
      window.requestAnimationFrame(fightTick);
    }

    function spawnZefas(n = 3) {
      for (let i = 0; i < n; i++)
        chickenZefas.push({
          x: rand(160, 760),
          z: 400 + rand(0, 80),
          speed: rand(1, 2) + fightLevel * 0.2,
          hp: 40 + fightLevel * 10,
          alive: true
        });
    }

    function drawFight() {
      // —Ñ–æ–Ω 3–¥
      ctx.clearRect(0,0,900,600);
      // —Ç—Ä–∞–≤–∞
      ctx.fillStyle = "#70c33b";
      ctx.fillRect(0, 330, 900, 270);
      // –≥–æ—Ä–∏ (–ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–æ)
      ctx.fillStyle = "#5d7d5a";
      ctx.beginPath();
      ctx.moveTo(0,330); ctx.lineTo(200,180); ctx.lineTo(400,330); ctx.closePath();
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo(300,330); ctx.lineTo(500,190); ctx.lineTo(700,330); ctx.closePath();
      ctx.fill();
      // –¥–µ—Ä–µ–≤–∞
      for(let i=0;i<7;i++){
        let tx = 80 + i*120, ty = 330 - rand(40,90);
        ctx.fillStyle="#2d4e1d"; ctx.fillRect(tx,ty,18,60);
        ctx.beginPath(); ctx.arc(tx+9,ty,35,0,2*Math.PI); ctx.fillStyle="#348f3d"; ctx.fill();
      }
      // 3d —Å—Ç—ñ–Ω–∏
      ctx.fillStyle = "#666";
      ctx.fillRect(100, 300, 20, 240);
      ctx.fillRect(780, 300, 20, 240);

      // –ß—ñ–∫—î–Ω–ó—î—Ñ–∏
      for (let c of chickenZefas) {
        if (!c.alive) continue;
        let scale = 1 + c.z/250;
        let x = c.x, y = 300 + 200 - c.z;
        ctx.save();
        ctx.translate(x, y);
        ctx.scale(scale, scale);
        if (imgChicken.complete) ctx.drawImage(imgChicken, -30, -50, 60, 70);
        else {
          ctx.fillStyle = "#fff";
          ctx.fillRect(-30, -50, 60, 70);
          ctx.fillStyle = "#222";
          ctx.fillText("üêî", -20, -10);
        }
        ctx.restore();
        // HP –±–∞—Ä
        ctx.fillStyle = "#d11";
        ctx.fillRect(x-30, y-60, 60*c.hp/100, 8);
      }
      // –≥—Ä–∞–≤–µ—Ü—å
      ctx.fillStyle = "#FFB400";
      ctx.fillRect(player.x-25, player.y-70, 50, 80);
      // –±—É—Ä–≥–µ—Ä-–ø–æ—Å—Ç—Ä—ñ–ª–∏
      for (let p of projectiles) {
        let scale = 1 + p.z/200;
        let px = p.x, py = player.y - 70 - p.z;
        ctx.save();
        ctx.translate(px, py);
        ctx.scale(scale, scale);
        ctx.fillStyle = "#dbb15c";
        ctx.beginPath();
        ctx.arc(0, 0, 18, 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
      }
    }

    // --- –°—Ç—Ä—ñ–ª—å–±–∞ –±—É—Ä–≥–µ—Ä–æ–º ---
    window.addEventListener('keydown', e => {
      keys[e.key] = true;
      // –ü—Ä–æ–±—ñ–ª ‚Äî –ø–æ—Å—Ç—Ä—ñ–ª
      if (gameState === 'fight' && e.key === ' ' && burgers > 0) {
        projectiles.push({ x: player.x, z: 0, active: true });
        burgers--;
      }
    });
    window.addEventListener('keyup', e => { keys[e.key] = false; });

    // --- –°—Ç–∞—Ä—Ç ---
    showMenu();
  </script>
</body>
</html>
