<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ó—î—Ñ–∞–ë—É—Ä–≥—î—Ä</title>
    <style>
        body { margin:0; background:#222; overflow: hidden;}
        canvas { display:block; margin:auto; background:#3a3a3a; }
        #ui { position:fixed; top:10px; left:50%; transform:translateX(-50%); color:white; font-family:sans-serif; }
        #cookBtn { padding:8px 16px; font-size:18px; background:#d2691e; border:none; border-radius:6px; cursor:pointer;}
        #cookBtn:active { background:#b14b0b; }
    </style>
</head>
<body>
    <div id="ui">
        <button id="cookBtn">–ì–æ—Ç—É–≤–∞—Ç–∏ –±—É—Ä–≥–µ—Ä üçî</button>
        <span id="burgers">–ë—É—Ä–≥–µ—Ä—ñ–≤: 0</span>
        <span id="score" style="margin-left:20px;">–û—á–∫–∏: 0</span>
    </div>
    <canvas id="game" width="900" height="600"></canvas>
    <script>
    // Canvas & Context
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    // UI
    const burgerCountSpan = document.getElementById('burgers');
    const scoreSpan = document.getElementById('score');
    const cookBtn = document.getElementById('cookBtn');

    // Assets
    const chickenImg = new Image();
    chickenImg.src = 'zefaburgerchickenzefa.png'; // 2D —Å–ø—Ä–∞–π—Ç –∫—É—Ä–∫–∏

    // Game state
    let burgers = 0; // –≥–æ—Ç–æ–≤—ñ –±—É—Ä–≥–µ—Ä–∏
    let score = 0;
    let bullets = []; // {x,y,z,vz}
    let chickens = []; // {x,y,z,speedZ,dirX,baseY}
    let lastChickenTime = 0;

    // Camera params
    const camY = 300;
    const camZ = -1200;
    const burgerSpeed = 24;
    const chickenMinZ = 300; // –∫–æ–ª–∏ –∫—É—Ä–∫–∞ –¥–æ—Å—è–≥–∞—î —Ü—å–æ–≥–æ Z ‚Äî –≤–æ–Ω–∞ "–ø—Ä–æ—Ö–æ–¥–∏—Ç—å"
    const chickenMaxZ = 1200;

    // Burger cooking
    cookBtn.addEventListener('click', () => {
        burgers++;
        burgerCountSpan.innerText = '–ë—É—Ä–≥–µ—Ä—ñ–≤: ' + burgers;
    });

    // Fire burger
    canvas.addEventListener('mousedown', (e) => {
        if (burgers <= 0) return;
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;

        // –í–∏—Ä–∞—Ö—É—î–º–æ –Ω–∞–ø—Ä—è–º–æ–∫ (–∑ —Ü–µ–Ω—Ç—Ä—É –µ–∫—Ä–∞–Ω–∞ –≤–ø–µ—Ä–µ–¥ –¥–æ —Ç–æ—á–∫–∏ –∫–ª–∏–∫—É)
        const target = screenToWorld(mx, my, chickenMinZ);
        // –ë—É—Ä–≥–µ—Ä –ª–µ—Ç–∏—Ç—å –∑ —Ü–µ–Ω—Ç—Ä—É (x=0, y=camY, z=camZ)
        const dx = target.x;
        const dy = target.y - camY;
        const dz = chickenMinZ - camZ;
        const len = Math.sqrt(dx*dx + dy*dy + dz*dz);
        bullets.push({
            x: 0,
            y: camY,
            z: camZ,
            vx: dx/len * burgerSpeed,
            vy: dy/len * burgerSpeed,
            vz: dz/len * burgerSpeed
        });
        burgers--;
        burgerCountSpan.innerText = '–ë—É—Ä–≥–µ—Ä—ñ–≤: ' + burgers;
    });

    // 2.5D Projection
    function worldToScreen(x, y, z) {
        // –ü—Ä–æ—Å—Ç–∞ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞
        const scale = 700 / (z - camZ);
        return {
            sx: canvas.width/2 + x * scale,
            sy: y * scale
        };
    }
    function screenToWorld(sx, sy, z) {
        // –ù–∞–≤–ø–∞–∫–∏, –∑ –µ–∫—Ä–∞–Ω–∞ –¥–æ —Å–≤—ñ—Ç—É (–¥–ª—è –ø—Ä–∏—Ü—ñ–ª—é–≤–∞–Ω–Ω—è)
        const scale = 700 / (z - camZ);
        return {
            x: (sx - canvas.width/2) / scale,
            y: sy / scale
        };
    }

    // Spawn chicken
    function spawnChicken() {
        // –í–∏–ø–∞–¥–∫–æ–≤–µ X, Y, –Ω–∞–ø—Ä—è–º–æ–∫
        const x = (Math.random()-0.5)*700;
        const y = 180 + Math.random()*100;
        const z = chickenMaxZ;
        const dirX = Math.random() < 0.5 ? -1 : 1;
        const speedZ = 4 + Math.random()*2;
        chickens.push({ x, y, z, speedZ, dirX, baseY: y, walkPhase: Math.random()*Math.PI*2 });
    }

    // Game Loop
    function update(dt) {
        // –ö—É—Ä–∫–∏ —Ä—É—Ö–∞—é—Ç—å—Å—è –¥–æ –≥—Ä–∞–≤—Ü—è –ø–æ Z, —Ç—Ä–æ—Ö–∏ –≥—É–ª—è—é—Ç—å –ø–æ X
        for (let c of chickens) {
            c.z -= c.speedZ;
            // 2D —Ä—É—Ö –ø–æ X ‚Äî –≥—É–ª—è—é—Ç—å —Å–∏–Ω—É—Å–æ—ó–¥–æ—é
            c.x += Math.sin(Date.now()/400 + c.walkPhase) * 1.5 * c.dirX;
            c.y = c.baseY + Math.sin(Date.now()/360 + c.walkPhase) * 10;
        }
        // –í–∏–¥–∞–ª—è—î–º–æ –∫—É—Ä–æ–∫, —â–æ –ø—Ä–æ–π—à–ª–∏ "–ª—ñ–Ω—ñ—é"
        chickens = chickens.filter(c => {
            if (c.z < chickenMinZ) {
                // –ì—Ä–∞–≤–µ—Ü—å –ø—Ä–æ–≥–∞–≤–∏–≤ –∫—É—Ä–∫—É ‚Äî –º—ñ–Ω—É—Å –æ—á–∫–∏
                score = Math.max(0, score-2);
                scoreSpan.innerText = '–û—á–∫–∏: ' + score;
                return false;
            }
            return true;
        });

        // –ë—É—Ä–≥–µ—Ä–∏ –ª–µ—Ç—è—Ç—å –≤–ø–µ—Ä–µ–¥
        for (let b of bullets) {
            b.x += b.vx;
            b.y += b.vy;
            b.z += b.vz;
        }
        // –í–∏–¥–∞–ª–∏—Ç–∏ –±—É—Ä–≥–µ—Ä–∏, —è–∫—ñ –≤–∏–ª–µ—Ç—ñ–ª–∏ –¥–∞–ª–µ–∫–æ
        bullets = bullets.filter(b => b.z < chickenMaxZ && b.z > camZ);

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω—å
        for (let bi = bullets.length-1; bi >= 0; bi--) {
            const b = bullets[bi];
            for (let ci = chickens.length-1; ci >= 0; ci--) {
                const c = chickens[ci];
                // –ü—Ä–æ—Å—Ç–∏–π —Ö—ñ—Ç–±–æ–∫—Å
                const dx = b.x - c.x;
                const dy = b.y - c.y;
                const dz = b.z - c.z;
                if (Math.abs(dz) < 80 && dx*dx + dy*dy < 130*130) {
                    // –í–ª—É—á–∏–≤!
                    bullets.splice(bi, 1);
                    chickens.splice(ci, 1);
                    score += 5;
                    scoreSpan.innerText = '–û—á–∫–∏: ' + score;
                    break;
                }
            }
        }

        // –°–ø–∞–≤–Ω –∫—É—Ä–æ–∫
        if (Date.now() - lastChickenTime > 1200 + Math.random()*600) {
            spawnChicken();
            lastChickenTime = Date.now();
        }
    }

    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        // –ö—É—Ä–∏ ‚Äî –º–∞–ª—é—î–º–æ –¥–∞–ª—ñ, –ø–æ—Ç—ñ–º –±–ª–∏–∂—á–µ (–ø–æ z)
        chickens.slice().sort((a,b) => b.z-a.z).forEach(c => {
            const {sx, sy} = worldToScreen(c.x, c.y, c.z);
            const scale = 0.26 + 0.7*((chickenMaxZ-c.z)/(chickenMaxZ-chickenMinZ));
            if (chickenImg.complete && chickenImg.naturalWidth) {
                ctx.save();
                ctx.translate(sx, sy);
                ctx.scale(scale, scale);
                ctx.drawImage(chickenImg, -chickenImg.width/2, -chickenImg.height/1.5);
                ctx.restore();
            } else {
                // –ó–∞–≥–ª—É—à–∫–∞
                ctx.fillStyle = 'yellow';
                ctx.beginPath();
                ctx.arc(sx, sy, 32*scale, 0, 2*Math.PI);
                ctx.fill();
            }
        });

        // –ë—É—Ä–≥–µ—Ä–∏ (–∫—É–ª—è)
        for (let b of bullets) {
            const {sx, sy} = worldToScreen(b.x, b.y, b.z);
            ctx.save();
            ctx.translate(sx, sy);
            ctx.fillStyle = '#d2691e';
            ctx.beginPath();
            ctx.arc(0,0, 22*(1-(b.z-camZ)/(chickenMaxZ-camZ)), 0, 2*Math.PI);
            ctx.shadowColor = "#fff0";
            ctx.fill();
            ctx.restore();
        }
    }

    // Main loop
    let lastTime = performance.now();
    function loop(now) {
        let dt = Math.min((now-lastTime)/16, 2); // max 2x speedup
        update(dt);
        draw();
        lastTime = now;
        requestAnimationFrame(loop);
    }
    // –°—Ç–∞—Ä—Ç
    chickenImg.onload = () => { loop(performance.now()); };
    // –Ø–∫—â–æ —Å–ø—Ä–∞–π—Ç –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è, –≤—Å–µ –æ–¥–Ω–æ —Å—Ç–∞—Ä—Ç—É—î–º–æ —á–µ—Ä–µ–∑ 1 —Å–µ–∫
    setTimeout(() => { loop(performance.now()); }, 1000);
    </script>
</body>
</html>
