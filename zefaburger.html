<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ЗєфаБургєр</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
        #menu, #shop, #kitchen, #fight { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: rgba(0, 0, 0, 0.8); 
            color: white; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
            font-family: Arial, sans-serif; 
        }
        button { 
            margin: 10px; 
            padding: 10px 20px; 
            font-size: 18px; 
            cursor: pointer; 
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
</head>
<body>
    <div id="menu">
        <h1>ЗєфаБургєр</h1>
        <button onclick="showShop()">Магаз</button>
        <button onclick="showKitchen()">Кухня</button>
        <button onclick="startFight()">Драка</button>
    </div>
    <div id="shop" style="display: none;">
        <h1>Магаз</h1>
        <p>Гроші: <span id="money">100</span></p>
        <p>Інгредієнти: <span id="ingredients">0</span></p>
        <p>Швидкість: <span id="cookSpeed">1</span></p>
        <p>Здоров'я: <span id="health">100</span></p>
        <p>Шкода: <span id="damage">10</span></p>
        <button onclick="buyIngredient()">Купити інгредієнт (10)</button>
        <button onclick="upgradeSpeed()">Покращити швидкість (50)</button>
        <button onclick="upgradeHealth()">Покращити здоров'я (50)</button>
        <button onclick="upgradeDamage()">Покращити шкоду (50)</button>
        <button onclick="backToMenu()">Назад</button>
    </div>
    <div id="kitchen" style="display: none;">
        <h1>Кухня</h1>
        <p>Інгредієнти: <span id="kitchenIngredients">0</span></p>
        <p>Бургери: <span id="burgers">0</span></p>
        <button onclick="cookBurger()">Готувати бургер</button>
        <button onclick="backToMenu()">Назад</button>
    </div>
    <div id="fight" style="display: none;">
        <h1>Драка</h1>
        <p>Час: <span id="time">180</span> сек</p>
        <p>Здоров'я: <span id="playerHealth">100</span></p>
        <p>Бургери: <span id="fightBurgers">0</span></p>
        <p>Рівень: <span id="level">1</span></p>
        <button onclick="backToMenu()">Назад</button>
    </div>
    <script>
        let scene, camera, renderer, player, enemies = [], burgers = [];
        let gameState = 'menu';
        let money = 100, ingredients = 0, burgersCount = 0;
        let cookSpeed = 1, maxHealth = 100, damage = 10;
        let playerHealth = maxHealth, level = 1, timeLeft = 180;
        let playerPosition = 0; // -1 (ліва стіна), 0 (центр), 1 (права стіна)
        let enemySpawnRate = 2;

        function initGame() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Фон: поляна з деревами та горами
            const backgroundGeometry = new THREE.PlaneGeometry(20, 10);
            const backgroundMaterial = new THREE.MeshBasicMaterial({ color: 0x228B22 });
            const background = new THREE.Mesh(backgroundGeometry, backgroundMaterial);
            background.position.z = -10;
            scene.add(background);

            // Стіни
            const wallGeometry = new THREE.BoxGeometry(1, 5, 0.5);
            const wallMaterial = new THREE.MeshBasicMaterial({ color: 0x808080 });
            const leftWall = new THREE.Mesh(wallGeometry, wallMaterial);
            leftWall.position.set(-5, 0, 0);
            scene.add(leftWall);
            const rightWall = new THREE.Mesh(wallGeometry, wallMaterial);
            rightWall.position.set(5, 0, 0);
            scene.add(rightWall);

            // Гравець
            const playerGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
            const playerMaterial = new THREE.MeshBasicMaterial({ color: 0x0000FF });
            player = new THREE.Mesh(playerGeometry, playerMaterial);
            scene.add(player);

            window.addEventListener('keydown', handleInput);
            animate();
        }

        function handleInput(event) {
            if (gameState === 'fight') {
                if (event.key === 'ArrowLeft') playerPosition = -1;
                if (event.key === 'ArrowRight') playerPosition = 1;
                if (event.key === ' ') shootBurger();
            }
        }

        function showShop() {
            gameState = 'shop';
            document.getElementById('menu').style.display = 'none';
            document.getElementById('shop').style.display = 'block';
            updateShopUI();
        }

        function showKitchen() {
            gameState = 'kitchen';
            document.getElementById('menu').style.display = 'none';
            document.getElementById('kitchen').style.display = 'block';
            updateKitchenUI();
        }

        function startFight() {
            gameState = 'fight';
            document.getElementById('menu').style.display = 'none';
            document.getElementById('fight').style.display = 'block';
            playerHealth = maxHealth;
            timeLeft = 180;
            enemies = [];
            burgers = [];
            level = 1;
            enemySpawnRate = 2;
            updateFightUI();
            initGame();
        }

        function backToMenu() {
            gameState = 'menu';
            document.getElementById('shop').style.display = 'none';
            document.getElementById('kitchen').style.display = 'none';
            document.getElementById('fight').style.display = 'none';
            document.getElementById('menu').style.display = 'block';
            if (renderer) renderer.domElement.remove();
        }

        function buyIngredient() {
            if (money >= 10) {
                money -= 10;
                ingredients += 1;
                updateShopUI();
            }
        }

        function upgradeSpeed() {
            if (money >= 50) {
                money -= 50;
                cookSpeed += 1;
                updateShopUI();
            }
        }

        function upgradeHealth() {
            if (money >= 50) {
                money -= 50;
                maxHealth += 10;
                playerHealth = maxHealth;
                updateShopUI();
            }
        }

        function upgradeDamage() {
            if (money >= 50) {
                money -= 50;
                damage += 5;
                updateShopUI();
            }
        }

        function cookBurger() {
            if (ingredients >= 1) {
                ingredients -= 1;
                setTimeout(() => {
                    burgersCount += 1;
                    updateKitchenUI();
                }, 3000 / cookSpeed);
            }
        }

        function shootBurger() {
            if (burgersCount > 0) {
                burgersCount -= 1;
                const burgerGeometry = new THREE.SphereGeometry(0.2, 8, 8);
                const burgerMaterial = new THREE.MeshBasicMaterial({ color: 0x8B4513 });
                const burger = new THREE.Mesh(burgerGeometry, burgerMaterial);
                burger.position.set(playerPosition * 4, 0, 0);
                burger.velocity = 0.1;
                burgers.push(burger);
                scene.add(burger);
                updateFightUI();
            }
        }

        function spawnEnemy() {
            const enemyGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
            const enemyMaterial = new THREE.MeshBasicMaterial({ color: 0xFF0000 }); // Замість zefaburgerchickenzefa.png
            const enemy = new THREE.Mesh(enemyGeometry, enemyMaterial);
            enemy.position.set(Math.random() * 10 - 5, 0, -8);
            enemy.velocity = 0.05 * level;
            enemies.push(enemy);
            scene.add(enemy);
        }

        function updateShopUI() {
            document.getElementById('money').textContent = money;
            document.getElementById('ingredients').textContent = ingredients;
            document.getElementById('cookSpeed').textContent = cookSpeed;
            document.getElementById('health').textContent = maxHealth;
            document.getElementById('damage').textContent = damage;
        }

        function updateKitchenUI() {
            document.getElementById('kitchenIngredients').textContent = ingredients;
            document.getElementById('burgers').textContent = burgersCount;
        }

        function updateFightUI() {
            document.getElementById('time').textContent = Math.floor(timeLeft);
            document.getElementById('playerHealth').textContent = playerHealth;
            document.getElementById('fightBurgers').textContent = burgersCount;
            document.getElementById('level').textContent = level;
        }

        function animate() {
            if (gameState !== 'fight') return;
            requestAnimationFrame(animate);

            // Оновлення позиції гравця
            player.position.x = playerPosition * 4;

            // Оновлення ворогів
            if (Math.random() < enemySpawnRate / 60) spawnEnemy();
            enemies.forEach((enemy, index) => {
                enemy.position.z += enemy.velocity;
                if (enemy.position.z > 0 && Math.abs(enemy.position.x - player.position.x) < 0.5) {
                    playerHealth -= 20;
                    scene.remove(enemy);
                    enemies.splice(index, 1);
                    updateFightUI();
                }
                if (enemy.position.z > 5) {
                    scene.remove(enemy);
                    enemies.splice(index, 1);
                }
            });

            // Оновлення бургерів
            burgers.forEach((burger, bIndex) => {
                burger.position.z += burger.velocity;
                enemies.forEach((enemy, eIndex) => {
                    if (Math.abs(burger.position.x - enemy.position.x) < 0.5 && Math.abs(burger.position.z - enemy.position.z) < 0.5) {
                        scene.remove(enemy);
                        scene.remove(burger);
                        enemies.splice(eIndex, 1);
                        burgers.splice(bIndex, 1);
                        money += 5;
                    }
                });
                if (burger.position.z > 10) {
                    scene.remove(burger);
                    burgers.splice(bIndex, 1);
                }
            });

            // Оновлення часу та рівня
            timeLeft -= 1 / 60;
            if (timeLeft <= 0) {
                level += 1;
                timeLeft = 180;
                enemySpawnRate += 0.5;
                updateFightUI();
            }

            // Перевірка програшу
            if (playerHealth <= 0) {
                alert('Гру закінчено! Ви програли.');
                backToMenu();
            }

            renderer.render(scene, camera);
        }

        initGame();
    </script>
</body>
</html>
