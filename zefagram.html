<!DOCTYPE html>
<html lang='uk'>
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<title>–ó—î—Ñ–∞–≥—Ä–∞–º</title>
<style>
@font-face{font-family:'Minecraft';src:url('minecraft-mojangles.otf') format('opentype');}
body{margin:0;font-family:Arial,sans-serif;background:url('zefagrambackground.png') center/cover no-repeat;display:flex;flex-direction:column;height:100vh;}
.screen{display:none;flex-direction:column;align-items:center;width:100%;max-width:600px;margin:auto;background:rgba(255,255,255,0.95);border-radius:12px;padding:15px;box-shadow:0 2px 6px rgba(0,0,0,0.2);height:95vh;}
h2{text-align:center;margin:10px 0;}
input,button{padding:10px;margin:5px;border-radius:6px;border:1px solid #ccc;font-size:16px;}
button{cursor:pointer;background:#0084ff;color:white;border:none;}
button:hover{background:#0066cc;}
.topbar{width:100%;display:flex;justify-content:center;align-items:center;position:relative;margin-bottom:10px;}
.back{padding:8px 16px;border-radius:20px;color:white;border:none;cursor:pointer;background:#555;}
.back:hover{background:#333;}
#messages{flex:1;width:100%;overflow-y:auto;background:rgba(255,255,255,0.8);border-radius:10px;padding:10px;margin-bottom:0;}
.message{display:inline-block;clear:both;margin:6px 0;padding:10px;border-radius:15px;max-width:70%;word-wrap:break-word;font-family:'Minecraft',Arial;}
.message strong{color:#0084ff;}
.from-me{background:#cfe9ff;float:right;}
.from-others{background:#e9ecef;float:left;}
#input-area{display:flex;width:100%;border-top:1px solid #ddd;padding:10px;background:rgba(255,255,255,0.95);}
#messageInput{flex:1;border-radius:20px;padding:10px 15px;border:1px solid #ccc;font-size:16px;}
#sendBtn{width:50px;margin-left:10px;border-radius:50%;font-size:20px;}
#voiceMsgBtn{margin-left:5px;font-size:20px;border-radius:50%;background:#0084ff;}
#voiceMsgBtn.active{background:green;}
#formatBtn{margin-right:5px;}
.formatMenu{display:none;flex-direction:column;background:#eee;padding:5px;border-radius:8px;position:absolute;bottom:60px;left:10px;z-index:10;}
.formatMenu button{margin:2px;}
.emojiPicker{display:flex;gap:5px;margin-top:5px;flex-wrap:wrap;justify-content:center;}
.emojiPicker img{width:40px;height:40px;cursor:pointer;}
.menuBtn{padding:10px 15px;width:90%;margin:5px;text-align:center;border-radius:12px;background:#0084ff;color:white;}
.menuBtn:hover{background:#0066cc;}
#menuGreetingWrapper{display:flex;flex-direction:column;align-items:center;margin-bottom:10px;}
#menuGreeting{margin-bottom:10px;}
.menuActions{display:flex;gap:10px;margin-top:10px;justify-content:center;}
.callBtn{margin-left:10px;padding:5px 10px;background:green;color:white;border-radius:6px;}
@media(max-width:500px){.screen{width:95%;padding:10px;}#input-area{padding:5px;}#messageInput{font-size:14px;padding:8px;}}
</style>
</head>
<body>
<div id='authScreen' class='screen'>
<h2>–ó—î—Ñ–∞–≥—Ä–∞–º</h2>
<input type='text' id='username' placeholder='–í–≤–µ–¥—ñ—Ç—å —é–∑—î—Ä–Ω–∞–º—î'>
<input type='password' id='password' placeholder='–ü–∞—Ä–æ–ª—å'>
<button id='registerBtn'>–ó–∞—Ä–µ–≥–∞—Ç—å—Å—è</button>
<button id='loginBtn'>–í–æ–π—Ç–∏</button>
<button id='backAuth' class='back' onclick='location.href="index.html"'>‚¨Ö –ù–∞–∑–∞–¥</button>
</div>
<div id='menuScreen' class='screen'>
<div id='menuGreetingWrapper'>
<h2 id='menuGreeting'></h2>
</div>
<button class='menuBtn' id='publicChatBtn'>–°–ø—ñ–ª—å–Ω–∏–π —á–∞—Ç</button>
<button class='menuBtn' id='publicVoiceBtn'>–°–ø—ñ–ª—å–Ω–∏–π –≥–æ–ª–æ—Å–æ–≤–∏–π —á–∞—Ç</button>
<button class='menuBtn' id='privateChatsBtn'>–ü—Ä–∏–≤–∞—Ç–Ω—ñ —á–∞—Ç–∏</button>
<button class='menuBtn' id='createPrivateBtn'>–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π —á–∞—Ç</button>
<div class='menuActions'>
<button id='backMenu' class='back'>‚¨Ö –ù–∞–∑–∞–¥</button>
<button id='logoutMenu' class='back'>–í–∏–π—Ç—ñ</button>
</div>
</div>
<div id='chatScreen' class='screen'>
<div class='topbar'>
<h2 id='chatTitle'></h2>
</div>
<div id='messages'></div>
<div id='input-area'>
<button id='formatBtn'>‚Ä¶</button>
<div class='formatMenu' id='formatMenu'>
<button data-format='B'>B</button>
<button data-format='I'>I</button>
<button data-format='U'>U</button>
<button data-format='S'>S</button>
<button data-format='MONO'>MONO</button>
</div>
<input type='text' id='messageInput' placeholder='–ü–Ü–®–ò!!!'>
<button id='sendBtn'>‚Üí</button>
<button id='voiceMsgBtn'>üéôÔ∏è</button>
</div>
<div class='emojiPicker' id='emojiPicker'>
<img src='zefasticker1.png'>
<img src='zefasticker2.png'>
<img src='zefasticker3.png'>
<img src='zefasticker4.png'>
<img src='zefasticker5.png'>
</div>
<div class='menuActions'>
<button id='backChat' class='back'>‚¨Ö –ù–∞–∑–∞–¥</button>
</div>
</div>
<script type='module'>
import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js'
import { getDatabase, ref, set, push, onChildAdded, get, child } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js'
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-storage.js'
const firebaseConfig={apiKey:'AIzaSyBp_RXjmWLfK0wX8sDb1d_VQogZgwzaNFA',authDomain:'zefagram.firebaseapp.com',databaseURL:'https://zefagram-default-rtdb.europe-west1.firebasedatabase.app',projectId:'zefagram',storageBucket:'zefagram.firebasestorage.app',messagingSenderId:'664999563847',appId:'1:664999563847:web:3051100a05bdb41dc59762'}
const app=initializeApp(firebaseConfig)
const db=getDatabase(app)
const storage=getStorage(app)
let currentUser=localStorage.getItem('currentUser')
let currentChat=null
let chats={}
let peerConnections={}
const authScreen=document.getElementById('authScreen')
const menuScreen=document.getElementById('menuScreen')
const chatScreen=document.getElementById('chatScreen')
const usernameInput=document.getElementById('username')
const passwordInput=document.getElementById('password')
const registerBtn=document.getElementById('registerBtn')
const loginBtn=document.getElementById('loginBtn')
const menuGreeting=document.getElementById('menuGreeting')
const publicChatBtn=document.getElementById('publicChatBtn')
const publicVoiceBtn=document.getElementById('publicVoiceBtn')
const privateChatsBtn=document.getElementById('privateChatsBtn')
const createPrivateBtn=document.getElementById('createPrivateBtn')
const backMenu=document.getElementById('backMenu')
const logoutMenu=document.getElementById('logoutMenu')
const backChat=document.getElementById('backChat')
const chatTitle=document.getElementById('chatTitle')
const messagesDiv=document.getElementById('messages')
const messageInput=document.getElementById('messageInput')
const sendBtn=document.getElementById('sendBtn')
const voiceMsgBtn=document.getElementById('voiceMsgBtn')
const formatBtn=document.getElementById('formatBtn')
const formatMenu=document.getElementById('formatMenu')
const emojiPicker=document.getElementById('emojiPicker')
function showMenu(greeting=true){authScreen.style.display='none';chatScreen.style.display='none';menuScreen.style.display='flex';if(greeting)menuGreeting.textContent=`–ü—Ä—ñ–≤—î—Ç, –¥—É—Ä–∞ ${currentUser}!`}
function saveUser(username,password){set(ref(db,'users/'+username),{password})}
function checkLogin(username,password){get(child(ref(db),'users/'+username)).then(snapshot=>{if(snapshot.exists()&&snapshot.val().password===password){currentUser=username;localStorage.setItem('currentUser',username);showMenu()}else{alert('–ù–µ–≤—ñ—Ä–Ω–∏–π —é–∑–µ—Ä–Ω–µ–π–º –∞–±–æ –ø–∞—Ä–æ–ª—å')}})}
registerBtn.onclick=()=>{const u=usernameInput.value.trim();const p=passwordInput.value.trim();if(!u||!p){alert('–í–≤–µ–¥—ñ—Ç—å —é–∑–µ—Ä–Ω–µ–π–º —ñ –ø–∞—Ä–æ–ª—å');return}saveUser(u,p);currentUser=u;localStorage.setItem('currentUser',u);showMenu()}
loginBtn.onclick=()=>{const u=usernameInput.value.trim();const p=passwordInput.value.trim();if(!u||!p){alert('–í–≤–µ–¥—ñ—Ç—å —é–∑–µ—Ä–Ω–µ–π–º —ñ –ø–∞—Ä–æ–ª—å');return}checkLogin(u,p)}
backMenu.onclick=()=>{location.href='index.html'}
logoutMenu.onclick=()=>{localStorage.removeItem('currentUser');currentUser=null;showMenu(false)}
backChat.onclick=()=>{chatScreen.style.display='none';menuScreen.style.display='flex';messagesDiv.innerHTML='';currentChat=null}
function openChat(chatId,title){menuScreen.style.display='none';chatScreen.style.display='flex';chatTitle.textContent=title;currentChat=chatId;messagesDiv.innerHTML='';const chatRef=ref(db,'messages/'+chatId);onChildAdded(chatRef,data=>addMessage(data.val()))}
function addMessage(msg){const div=document.createElement('div');div.className='message '+(msg.user===currentUser?'from-me':'from-others');div.innerHTML=`<strong>${msg.user}</strong>: ${msg.text} <small>(${msg.time})</small>`;messagesDiv.appendChild(div);messagesDiv.scrollTop=messagesDiv.scrollHeight}
sendBtn.onclick=()=>{const text=messageInput.value.trim();if(!text||!currentChat)return;const time=new Date();const t=`${time.getDate()}/${time.getMonth()+1} ${time.getHours()}:${time.getMinutes()}`;push(ref(db,'messages/'+currentChat),{user:currentUser,text,time:t});messageInput.value=''}
formatBtn.onclick=()=>{formatMenu.style.display=formatMenu.style.display==='flex'?'none':'flex'}
formatMenu.querySelectorAll('button').forEach(b=>{b.onclick=()=>{const sel=window.getSelection().toString();if(!sel)return;const format=b.dataset.format;const v=format==='B'?'<b>'+sel+'</b>':format==='I'?'<i>'+sel+'</i>':format==='U'?'<u>'+sel+'</u>':format==='S'?'<s>'+sel+'</s>':format==='MONO'?'<span style="font-family:monospace">'+sel+'</span>':sel;messageInput.value=messageInput.value.replace(sel,v)}})
emojiPicker.querySelectorAll('img').forEach(img=>{img.onclick=()=>{const t=`[sticker:${img.src}]`;messageInput.value+=t}})
publicChatBtn.onclick=()=>{openChat('public','–°–ø—ñ–ª—å–Ω–∏–π —á–∞—Ç')}
publicVoiceBtn.onclick=()=>{startPublicVoice()}
function startPublicVoice(){menuScreen.style.display='none';chatScreen.style.display='flex';chatTitle.textContent='–°–ø—ñ–ª—å–Ω–∏–π –≥–æ–ª–æ—Å–æ–≤–∏–π —á–∞—Ç';messagesDiv.innerHTML='';navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{voiceMsgBtn.onclick=()=>{voiceMsgBtn.classList.toggle('active');stream.getAudioTracks()[0].enabled=voiceMsgBtn.classList.contains('active')}})}
if(currentUser){showMenu()}
</script>
</body>
</html>
