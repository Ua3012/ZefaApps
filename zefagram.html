<!DOCTYPE html>
<html lang='uk'>
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<title>–ó—î—Ñ–∞–≥—Ä–∞–º</title>
<style>
@font-face{font-family:'Minecraft';src:url('minecraft-mojangles.otf') format('opentype');}
body{margin:0;font-family:Arial,sans-serif;background:url('zefagrambackground.png') center/cover no-repeat;display:flex;flex-direction:column;height:100vh;}
.screen{display:none;flex-direction:column;align-items:center;width:100%;max-width:600px;margin:auto;background:rgba(255,255,255,0.95);border-radius:12px;padding:15px;box-shadow:0 2px 6px rgba(0,0,0,0.2);height:95vh;}
h2{text-align:center;margin:10px 0;}
input,button{padding:10px;margin:5px;border-radius:6px;border:1px solid #ccc;font-size:16px;}
button{cursor:pointer;background:#0084ff;color:white;border:none;}
button:hover{background:#0066cc;}
.topbar{width:100%;display:flex;justify-content:center;align-items:center;position:relative;margin-bottom:10px;}
.back{padding:8px 16px;border-radius:20px;color:white;border:none;cursor:pointer;background:#555;}
.back:hover{background:#333;}
#messages{flex:1;width:100%;overflow-y:auto;background:rgba(255,255,255,0.8);border-radius:10px;padding:10px;margin-bottom:0;}
.message{display:inline-block;clear:both;margin:6px 0;padding:10px;border-radius:15px;max-width:70%;word-wrap:break-word;font-family:'Minecraft',Arial;position:relative;}
.message strong{color:#0084ff;}
.from-me{background:#cfe9ff;float:right;}
.from-others{background:#e9ecef;float:left;}
.ephemeral.from-me{background:#ff9999;}
.ephemeral.from-others{background:#ccffcc;}

#audioMsg{width:100%;margin-top:5px;}
#input-area{display:flex;width:100%;border-top:1px solid #ddd;padding:10px;background:rgba(255,255,255,0.95);}
#messageInput{flex:1;border-radius:20px;padding:10px 15px;border:1px solid #ccc;font-size:16px;}
#sendBtn{width:50px;margin-left:10px;border-radius:50%;font-size:20px;}
#voiceMsgBtn,#micToggleBtn{margin-left:5px;font-size:20px;border-radius:50%;background:#0084ff;}
#voiceMsgBtn.active,#micToggleBtn.active{background:red;}
.emojiPicker{display:flex;gap:5px;margin-top:5px;flex-wrap:wrap;justify-content:center;}
.emojiPicker img{width:40px;height:40px;cursor:pointer;}
.menuBtn{padding:10px 15px;width:90%;margin:5px;text-align:center;border-radius:12px;background:#0084ff;color:white;}
.menuBtn:hover{background:#0066cc;}
#menuGreetingWrapper{display:flex;flex-direction:column;align-items:center;margin-bottom:10px;}
#menuGreeting{margin-bottom:10px;}
.menuActions{display:flex;gap:10px;margin-top:10px;justify-content:center;}
#startCallBtn{margin-left:10px;padding:5px 10px;background:green;color:white;border-radius:6px;}
#startCallBtn.active{background:red;}
#endCallBtn {
    margin-left: 10px;
    padding: 5px 10px;
    border-radius: 6px;
    color: white;
    background: red;
}
.privateChatLink{display: block; width: 90%; padding: 10px; margin: 5px; text-align: center; border-radius: 6px; background: #e0e0e0; color: #333; cursor: pointer; border: 1px solid #ccc;}
.privateChatLink:hover{background: #d0d0d0;}
@media(max-width:500px){.screen{width:95%;padding:10px;}#input-area{padding:5px;}#messageInput{font-size:14px;padding:8px;}}
</style>
</head>
<body>

<div id='authScreen' class='screen'>
<h2>–ó—î—Ñ–∞–≥—Ä–∞–º</h2>
<input type='text' id='username' placeholder='–í–≤–µ–¥—ñ—Ç—å —é–∑—î—Ä–Ω–∞–º—î'>
<input type='password' id='password' placeholder='–ü–∞—Ä–æ–ª—å'>
<button id='registerBtn'>–ó–∞—Ä–µ–≥–∞—Ç—å—Å—è</button>
<button id='loginBtn'>–í–≤—ñ–π—Ç—ñ</button>
<button id='backAuth' class='back'>‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<div id='menuScreen' class='screen'>
<div id='menuGreetingWrapper'>
<h2 id='menuGreeting'></h2>
</div>
<button class='menuBtn' id='publicChatBtn'>–û–±—â—ñ–π —á–∞—Ç</button>
<button class='menuBtn' id='publicVoiceBtn'>–û–±—â—ñ–π –≥–æ–ª–æ—Å–æ–≤–∏–π —á–∞—Ç</button>
<button class='menuBtn' id='privateChatsBtn'>–ü—Ä—ñ–≤–∞—Ç–Ω—ñ —á–∞—Ç–∏</button>
<button class='menuBtn' id='createPrivateBtn'>–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä—ñ–≤–∞—Ç–Ω–∏–π —á–∞—Ç</button>
<div class='menuActions'>
<button id='logoutMenu' class='back'>–í–∏–π—Ç—ñ</button>
<button id='backMenu' class='back'>‚¨Ö –ù–∞–∑–∞–¥ –∫ –ó—î—Ñ–∞–ê–ø–ø—Å</button>
</div>
</div>

<div id='chatScreen' class='screen'>
<div class='topbar'>
<h2 id='chatTitle'></h2>
<button id='startCallBtn' style='display:none;'>üìû –†–æ–∑–º–æ–≤–∞</button>
<button id='endCallBtn' style='display:none;'>‚ùå –ó–∞–≤–µ—Ä—à–∏—Ç–∏</button>
<div id='callStatus' style='color:red; margin-left:10px;'></div>
</div>
<div id='messages'></div>
<div id='input-area'>
<input type='text' id='messageInput' placeholder='–ü–Ü–®–ò!!!'>
<button id='sendBtn'>‚Üí</button>
<button id='voiceMsgBtn'>üéôÔ∏è</button>
</div>
<div class='emojiPicker' id='emojiPicker'>
<img src='zefasticker1.png'>
<img src='zefasticker2.png'>
<img src='zefasticker3.png'>
<img src='zefasticker4.png'>
<img src='zefasticker5.png'>
</div>
<div class='menuActions'>
<button id='backChat' class='back'>‚¨Ö –ù–∞–∑–∞–¥</button>
</div>
</div>

<div id='voiceScreen' class='screen'>
<div class='topbar'>
<h2 id='voiceTitle'>–û–±—â—ñ–π –≥–∞–ª–∞—Å–æ–≤–∏–π —á–∞—Ç</h2>
</div>
<button id='micToggleBtn' style='font-size:40px;padding:30px;border-radius:50%;'>üéôÔ∏è –£–≤—ñ–º–∫–Ω—É—Ç–∏ –º—ñ–∫—Ä–æ—Ñ–æ–Ω</button>
<div id='voiceStatus' style='color:red; margin-top:10px;'>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è —Ä–æ–∑–º–æ–≤–∏</div>
<div id='voiceUsers' style='margin-top:20px; width:100%; text-align:center;'></div>
<button id='backVoice' class='back' style='margin-top:auto;'>‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<div id='privateChatsScreen' class='screen' style='display:none;'>
    <h2>–ü—Ä—ñ–≤–∞—Ç–Ω—ñ —á–∞—Ç–∏</h2>
    <div id='privateChatsList' style='width:100%; flex: 1; overflow-y: auto;'></div>
    <div class='menuActions'>
        <button id='backPrivateChats' class='back'>‚¨Ö –ù–∞–∑–∞–¥</button>
    </div>
</div>

<script type='module'>
import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js'
import { getDatabase, ref, set, push, get, child, onValue, update, remove } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js'

const firebaseConfig={apiKey:'AIzaSyBp_RXjmWLfK0wX8sDb1d_VQogZgwzaNFA',authDomain:'zefagram.firebaseapp.com',databaseURL:'https://zefagram-default-rtdb.europe-west1.firebasedatabase.app',projectId:'zefagram',storageBucket:'zefagram.firebasestorage.app',messagingSenderId:'664999563847',appId:'1:664999563847:web:3051100a05bdb41dc59762',measurementId:'G-CFS89PSQNK'}
const app=initializeApp(firebaseConfig)
const db=getDatabase(app)
let currentUser=localStorage.getItem('currentUser')||null
let currentChat='public'
let currentPartner = null
let mediaRecorder = null
let mediaStream = null
let isRecordingTimeout = null
let recordedChunks = []
let isSending = false
let processedMessages = new Set()

const authScreen=document.getElementById('authScreen')
const menuScreen=document.getElementById('menuScreen')
const chatScreen=document.getElementById('chatScreen')
const voiceScreen=document.getElementById('voiceScreen')
const privateChatsScreen=document.getElementById('privateChatsScreen')
const usernameInput=document.getElementById('username')
const passwordInput=document.getElementById('password')
const messagesDiv=document.getElementById('messages')
const chatTitle=document.getElementById('chatTitle')
const messageInput=document.getElementById('messageInput')
const menuGreeting=document.getElementById('menuGreeting')
const voiceUsersDiv=document.getElementById('voiceUsers')
const privateChatsList=document.getElementById('privateChatsList')
const startCallBtn = document.getElementById('startCallBtn')
const endCallBtn = document.getElementById('endCallBtn')
const callStatus = document.getElementById('callStatus')
const micToggleBtn = document.getElementById('micToggleBtn')
const voiceStatus = document.getElementById('voiceStatus')


function formatTime(date){return date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate()+' '+date.getHours()+':'+String(date.getMinutes()).padStart(2,'0')}
async function register(){const u=usernameInput.value.trim();const p=passwordInput.value.trim();if(!u||!p)return;const s=await get(child(ref(db),'users/'+u));if(s.exists())return;await set(ref(db,'users/'+u),{password:p, chats: {}});}
async function login(){const u=usernameInput.value.trim();const p=passwordInput.value.trim();if(!u||!p)return;const s=await get(child(ref(db),'users/'+u));if(!s.exists()||s.val().password!==p)return;currentUser=u;localStorage.setItem('currentUser',u);showMenu(true)}
function showMenu(show){authScreen.style.display='none';menuScreen.style.display=show?'flex':'none';chatScreen.style.display='none';voiceScreen.style.display='none';privateChatsScreen.style.display='none';if(show)menuGreeting.textContent=`–ü—Ä—ñ–≤—î—Ç, –¥—É—Ä–∞ ${currentUser}!`}
function getChatPath(){return currentChat === '–û–±—â—ñ–π —á–∞—Ç' ? 'messages/public' : 'messages/' + currentChat}

function deleteMessageFromDB(messageKey, chatID) {
    const path = chatID.startsWith('private_') ? 'messages/' + chatID : 'messages/public';
    remove(ref(db, path + '/' + messageKey));
}

function handleIncomingCallAudio(msg, messageKey, chatID) {
    if (msg.user === currentUser) return;
    if (processedMessages.has(messageKey)) return;
    processedMessages.add(messageKey);

    callStatus.textContent = '–í—Ö—ñ–¥–Ω–∞ —Ä–æ–∑–º–æ–≤–∞ –≤—ñ–¥ '+msg.user+'...';
    const audio = new Audio(msg.url);
    audio.autoplay = true;

    audio.onplaying = () => {callStatus.textContent = '–ó\'—î–¥–Ω–∞–Ω–æ –∑ '+msg.user;};
    audio.onended = () => {callStatus.textContent = '–†–æ–∑–º–æ–≤–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.';processedMessages.delete(messageKey);};
    audio.onerror = () => {callStatus.textContent = '–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—É–¥—ñ–æ.';processedMessages.delete(messageKey);};
}

function renderMessage(msgSnapshot){
    const msg = msgSnapshot.val();
    const messageKey = msgSnapshot.key;

    const d=document.createElement('div');
    d.id = 'msg-'+messageKey;
    d.className='message '+(msg.user===currentUser?'from-me':'from-others');
    
    let text=msg.text;
    if(msg.type==='sticker') {text=`<img src='${msg.url}' style='width:50px;height:50px'>`;} 
    else if(msg.type==='audio' || msg.type === 'ephemeral_audio') {
        text=`<audio controls src='${msg.url}'></audio>`;
    } 
    else {text=text.replace(/\*\*(.*?)\*\*/g,'<b>$1</b>').replace(/\*(.*?)\*/g,'<i>$1</i>').replace(/__(.*?)__/g,'<u>$1</u>').replace(/~~(.*?)~~/g,'<s>$1</s>').replace(/`(.*?)`/g,`<span style='font-family:monospace'>$1</span>`);}
    
    d.innerHTML=`<strong>${msg.user}</strong>: ${text} <small>(${msg.time})</small>`;
    
    if (msg.user === currentUser) {d.ondblclick = () => {if (confirm('–í–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è?')) {deleteMessageFromDB(messageKey, currentChat);}};
    }
    messagesDiv.appendChild(d);
    messagesDiv.scrollTop=messagesDiv.scrollHeight
}


function showChat(chat, partner=null){
    currentChat=chat;
    currentPartner=partner;
    messagesDiv.innerHTML='';
    showScreen('chatScreen');
    chatTitle.textContent=partner || chat;
    processedMessages.clear();

    const isPrivate = chat.startsWith('private_');
    startCallBtn.style.display = isPrivate ? 'inline-block' : 'none';
    endCallBtn.style.display = 'none';
    startCallBtn.textContent = 'üìû –†–æ–∑–º–æ–≤–∞';
    callStatus.textContent = '';
    
    const chatRef=ref(db, getChatPath());
    onValue(chatRef,snapshot=>{
        messagesDiv.innerHTML='';
        snapshot.forEach(c=>{
            renderMessage(c)
            if(c.val().type === 'ephemeral_audio' && isPrivate) {
                handleIncomingCallAudio(c.val(), c.key, chat)
            }
        });
    });
}

function showVoiceChat() {
    currentChat = 'public_voice';
    showScreen('voiceScreen');
    micToggleBtn.textContent = 'üéôÔ∏è –£–≤—ñ–º–∫–Ω—É—Ç–∏ –º—ñ–∫—Ä–æ—Ñ–æ–Ω';
    voiceStatus.textContent = '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è —Ä–æ–∑–º–æ–≤–∏';
    
    const presenceRef = ref(db, 'presence/public_voice');
    onValue(presenceRef, (snapshot) => {
        voiceUsersDiv.innerHTML = '–£—á–∞—Å–Ω–∏–∫–∏: ';
        const users = snapshot.val() || {};
        const activeUsers = Object.keys(users).filter(u => users[u] && u !== currentUser);
        voiceUsersDiv.innerHTML += activeUsers.length > 0 ? activeUsers.join(', ') : '–ù—ñ–∫–æ–≥–æ –Ω–µ–º–∞—î.';
    });
    
    set(ref(db, 'presence/public_voice/'+currentUser), true);
    window.onbeforeunload = () => {remove(ref(db, 'presence/public_voice/'+currentUser));};
}


function logout(){localStorage.removeItem('currentUser');currentUser=null;showScreen('authScreen')}
async function sendMessage(){const t=messageInput.value.trim();if(!t||!currentUser)return;push(ref(db, getChatPath()),{user:currentUser,text:t,time:formatTime(new Date()),type:'text'});messageInput.value='';}
async function sendSticker(url){push(ref(db, getChatPath()),{user:currentUser,url,type:'sticker',time:formatTime(new Date())})}

async function sendAudio(blob, type, chatPath) {
    if (isSending) return;
    isSending = true;
    const CLOUDINARY_CLOUD_NAME = 'doylfteu4'; 
    const CLOUDINARY_UPLOAD_PRESET = 'zefagram_audio'; 

    const formData = new FormData();
    formData.append('file', blob, 'audio.webm');
    formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
    
    let url = '';
    try {
        const response = await fetch('https://api.cloudinary.com/v1_1/'+CLOUDINARY_CLOUD_NAME+'/upload', { method: 'POST', body: formData });
        const data = await response.json();
        if (data.secure_url) {url = data.secure_url;} else {console.error('Cloudinary Response:', data);isSending = false;return;}
    } catch(e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∞—É–¥—ñ–æ: '+e.message);isSending = false;return;}

    const finalChatPath = (chatPath === 'messages/public_voice') ? 'messages/public' : chatPath;
    const isContinuous = (type === 'ephemeral_audio' && (currentChat.startsWith('private_') || currentChat === 'public_voice'));

    push(ref(db, finalChatPath),{
        user:currentUser,
        url:url,
        type:isContinuous ? 'ephemeral_audio' : 'audio', 
        time:formatTime(new Date())
    });
    
    if (isContinuous) {
        const statusEl = finalChatPath.includes('public') ? voiceStatus : callStatus;
        statusEl.textContent = '–ù–∞–¥—Å–∏–ª–∞—é...';
    }
    isSending = false;
}

async function showPrivateChats() {
    if (!currentUser) return;
    showScreen('privateChatsScreen');
    
    const userChatsRef = ref(db, 'users/'+currentUser+'/chats');
    onValue(userChatsRef, (snapshot) => {
        privateChatsList.innerHTML = '';
        if (snapshot.exists()) {
            const chats = snapshot.val();
            for (const chatID in chats) {
                const partner = chats[chatID].partner;
                const d = document.createElement('button');
                d.className = 'privateChatLink';
                d.textContent = '–ß–∞—Ç –∑: '+partner;
                d.onclick = () => showChat(chatID, partner);
                privateChatsList.appendChild(d);
            }
        } else {
            privateChatsList.innerHTML = '<p style=\'text-align: center; margin-top: 20px;\'>–ù–µ–º–∞—î –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö —á–∞—Ç—ñ–≤.</p>';
        }
    });
}

async function createPrivateChat() {
    const partner = prompt('–í–≤–µ–¥—ñ—Ç—å —é–∑—î—Ä–Ω–µ–π–º —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫–∞:');
    if (!partner || partner === currentUser) return;
    
    const partnerSnap = await get(child(ref(db), 'users/'+partner));
    if (!partnerSnap.exists()) return;
    
    const chatUsers = [currentUser, partner].sort();
    const chatID = 'private_'+chatUsers[0]+'_'+chatUsers[1];
    
    const updates = {};
    updates['/users/'+currentUser+'/chats/'+chatID] = { partner: partner };
    updates['/users/'+partner+'/chats/'+chatID] = { partner: currentUser };

    await update(ref(db), updates);
    showChat(chatID, partner);
}

function showScreen(screenId) {
    const screens = [authScreen, menuScreen, chatScreen, voiceScreen, privateChatsScreen];
    screens.forEach(screen => {
        screen.style.display = (screen.id === screenId) ? 'flex' : 'none';
    });
}

async function handleContinuousSend() {
    if (mediaRecorder && mediaRecorder.state === 'recording' && recordedChunks.length > 0) {
        const blob = new Blob(recordedChunks, {type:'audio/webm'});
        recordedChunks = []; 
        
        const chatPath = currentChat === 'public_voice' ? 'messages/public' : getChatPath();
        sendAudio(blob, 'ephemeral_audio', chatPath);
        
        startRecording('ephemeral_audio', true); 
    }
}

function stopRecording(send = false) {
    if (mediaRecorder && mediaRecorder.state === 'recording') {
        clearTimeout(isRecordingTimeout);
        mediaRecorder.stop();
        mediaRecorder = null;
        
        if (mediaStream) {
            mediaStream.getTracks().forEach(track => track.stop());
            mediaStream = null;
        }
        
        const isContinuous = currentChat.startsWith('private_') || currentChat === 'public_voice';

        if (send && recordedChunks.length > 0 && !isContinuous) { 
            const blob = new Blob(recordedChunks, {type:'audio/webm'});
            sendAudio(blob, 'audio', getChatPath());
        }
        
        recordedChunks = [];
        
        if (currentChat.startsWith('private_')) {
            startCallBtn.classList.remove('active');
            startCallBtn.textContent = 'üìû –†–æ–∑–º–æ–≤–∞';
            endCallBtn.style.display = 'none';
            callStatus.textContent = '–†–æ–∑–º–æ–≤–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.';
        } else if (currentChat === 'public_voice') {
            micToggleBtn.classList.remove('active');
            micToggleBtn.textContent = 'üéôÔ∏è –£–≤—ñ–º–∫–Ω—É—Ç–∏ –º—ñ–∫—Ä–æ—Ñ–æ–Ω';
            voiceStatus.textContent = '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è —Ä–æ–∑–º–æ–≤–∏';
        } else {
            document.getElementById('voiceMsgBtn').classList.remove('active');
        }
    }
}

async function startRecording(type, restart = false) {
    const isContinuous = type === 'ephemeral_audio';
    const isPrivateCall = isContinuous && currentChat.startsWith('private_');
    const isPublicVoice = isContinuous && currentChat === 'public_voice';
    const btn = isPrivateCall ? startCallBtn : (isPublicVoice ? micToggleBtn : document.getElementById('voiceMsgBtn'));
    const statusEl = isPrivateCall ? callStatus : (isPublicVoice ? voiceStatus : callStatus);
    const maxDuration = 15000;

    if (!currentUser) return;
    
    if(mediaRecorder && mediaRecorder.state === 'recording') {
        if (isContinuous) {
            clearTimeout(isRecordingTimeout);
            mediaRecorder.stop(); 
            const blob = new Blob(recordedChunks, {type:'audio/webm'});
            recordedChunks = []; 
            const chatPath = isPublicVoice ? 'messages/public' : getChatPath();
            sendAudio(blob, 'ephemeral_audio', chatPath);
            
            startRecording('ephemeral_audio', true); 
            return;
        } else {
            stopRecording(true);
            return;
        }
    }

    try {
        if (!restart || !mediaStream) {
            mediaStream = await navigator.mediaDevices.getUserMedia({audio:true});
        }
        mediaRecorder = new MediaRecorder(mediaStream);
        recordedChunks = [];
        
        btn.classList.add('active');
        btn.textContent = isContinuous ? 'üî¥ –ì–æ–≤–æ—Ä–∏—à...' : 'üî¥ –ó–∞–ø–∏—Å';
        statusEl.textContent = '–ó–∞–ø–∏—Å...';
        
        if (isPrivateCall) {
            endCallBtn.style.display = 'inline-block';
        }
        
        mediaRecorder.ondataavailable=e=>recordedChunks.push(e.data);
        
        mediaRecorder.onstop=e=>{
            if (!isContinuous) { 
                stopRecording(false);
            }
        };
        
        mediaRecorder.start();
        
        if (isContinuous) {
            isRecordingTimeout = setTimeout(handleContinuousSend, maxDuration);
        } else {
            isRecordingTimeout = setTimeout(() => {if (mediaRecorder && mediaRecorder.state === 'recording') {stopRecording(true);}}, maxDuration);
        }

    } catch(e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞: '+e.message);
        stopRecording(false);
        statusEl.textContent = '–ü–æ–º–∏–ª–∫–∞ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞.';
    }
}

document.querySelectorAll('#emojiPicker img').forEach(i=>i.onclick=e=>sendSticker(e.target.src))

document.getElementById('registerBtn').onclick=register
document.getElementById('loginBtn').onclick=login
document.getElementById('backMenu').onclick=()=>window.location.href='https://ua3012.github.io/ZefaApps/index.html'
document.getElementById('logoutMenu').onclick=logout
document.getElementById('backChat').onclick=()=>stopRecording(false) || showMenu(true)
document.getElementById('backVoice').onclick=()=> {stopRecording(false);remove(ref(db, 'presence/public_voice/'+currentUser));showMenu(true);}
document.getElementById('backAuth').onclick=()=>window.location.href='https://ua3012.github.io/ZefaApps/index.html'
document.getElementById('publicChatBtn').onclick=()=>showChat('–û–±—â—ñ–π —á–∞—Ç')
document.getElementById('sendBtn').onclick=sendMessage

document.getElementById('privateChatsBtn').onclick=showPrivateChats
document.getElementById('createPrivateBtn').onclick=createPrivateChat
document.getElementById('backPrivateChats').onclick=()=>showMenu(true)

document.getElementById('voiceMsgBtn').onclick=()=>startRecording('audio')
startCallBtn.onclick=()=>startRecording('ephemeral_audio')
endCallBtn.onclick=()=>stopRecording(false)
micToggleBtn.onclick=()=>startRecording('ephemeral_audio')
document.getElementById('publicVoiceBtn').onclick=showVoiceChat

window.onload=()=>{if(currentUser)showMenu(true);else authScreen.style.display='flex'}
</script>
</body>
</html>
