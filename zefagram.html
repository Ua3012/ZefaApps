<!DOCTYPE html>
<html lang='uk'>
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<title>Ğ—Ñ”Ñ„Ğ°Ğ³Ñ€Ğ°Ğ¼</title>
<style>
@font-face{font-family:'Minecraft';src:url('minecraft-mojangles.otf') format('opentype');}
body{margin:0;font-family:Arial,sans-serif;background:url('zefagrambackground.png') center/cover no-repeat;display:flex;flex-direction:column;height:100vh;}
.screen{display:none;flex-direction:column;align-items:center;width:100%;max-width:600px;margin:auto;background:rgba(255,255,255,0.95);border-radius:12px;padding:15px;box-shadow:0 2px 6px rgba(0,0,0,0.2);height:95vh;}
h2{text-align:center;margin:10px 0;}
input,button{padding:10px;margin:5px;border-radius:6px;border:1px solid #ccc;font-size:16px;}
button{cursor:pointer;background:#0084ff;color:white;border:none;}
button:hover{background:#0066cc;}
.topbar{width:100%;display:flex;justify-content:center;align-items:center;position:relative;margin-bottom:10px;}
.back{padding:8px 16px;border-radius:20px;color:white;border:none;cursor:pointer;background:#555;}
.back:hover{background:#333;}
#messages{flex:1;width:100%;overflow-y:auto;background:rgba(255,255,255,0.8);border-radius:10px;padding:10px;margin-bottom:0;}
.message{display:inline-block;clear:both;margin:6px 0;padding:10px;border-radius:15px;max-width:70%;word-wrap:break-word;font-family:'Minecraft',Arial;position:relative;}
.message strong{color:#0084ff;}
.from-me{background:#cfe9ff;float:right;}
.from-others{background:#e9ecef;float:left;}
#audioMsg{width:100%;margin-top:5px;}
#input-area{display:flex;width:100%;border-top:1px solid #ddd;padding:10px;background:rgba(255,255,255,0.95);}
#messageInput{flex:1;border-radius:20px;padding:10px 15px;border:1px solid #ccc;font-size:16px;}
#sendBtn{width:50px;margin-left:10px;border-radius:50%;font-size:20px;}
#voiceMsgBtn{margin-left:5px;font-size:20px;border-radius:50%;background:#0084ff;width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;}
#voiceMsgBtn.active{background:green;}
.emojiPicker{display:flex;gap:5px;margin-top:5px;flex-wrap:wrap;justify-content:center;}
.emojiPicker img{width:40px;height:40px;cursor:pointer;}
.menuBtn{padding:10px 15px;width:90%;margin:5px;text-align:center;border-radius:12px;background:#0084ff;color:white;}
.menuBtn:hover{background:#0066cc;}
#menuGreetingWrapper{display:flex;flex-direction:column;align-items:center;margin-bottom:10px;}
#menuGreeting{margin-bottom:10px;}
.menuActions{display:flex;gap:10px;margin-top:10px;justify-content:center;}
.privateChatLink{display: block; width: 90%; padding: 10px; margin: 5px; text-align: center; border-radius: 6px; background: #e0e0e0; color: #333; cursor: pointer; border: 1px solid #ccc;}
.privateChatLink:hover{background: #d0d0d0;}
@media(max-width:500px){.screen{width:95%;padding:10px;}#input-area{padding:5px;}#messageInput{font-size:14px;padding:8px;}}
</style>
</head>
<body>

<div id='authScreen' class='screen'>
<h2>Ğ—Ñ”Ñ„Ğ°Ğ³Ñ€Ğ°Ğ¼</h2>
<input type='text' id='username' placeholder='Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ ÑĞ·Ñ”Ñ€Ğ½Ğ°Ğ¼Ñ”'>
<input type='password' id='password' placeholder='ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ'>
<button id='registerBtn'>Ğ—Ğ°Ñ€ĞµĞ³Ğ°Ñ‚ÑŒÑÑ</button>
<button id='loginBtn'>Ğ’Ğ²Ñ–Ğ¹Ñ‚Ñ–</button>
<button id='backAuth' class='back'>â¬… ĞĞ°Ğ·Ğ°Ğ´</button>
</div>

<div id='menuScreen' class='screen'>
<div id='menuGreetingWrapper'>
<h2 id='menuGreeting'></h2>
</div>
<button class='menuBtn' id='publicChatBtn'>ĞĞ±Ñ‰Ñ–Ğ¹ Ñ‡Ğ°Ñ‚</button>
<button class='menuBtn' id='privateChatsBtn'>ĞŸÑ€Ñ–Ğ²Ğ°Ñ‚Ğ½Ñ– Ñ‡Ğ°Ñ‚Ğ¸</button>
<button class='menuBtn' id='createPrivateBtn'>Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ¿Ñ€Ñ–Ğ²Ğ°Ñ‚Ğ½Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚</button>
<button class='menuBtn' id='enableNotificationsBtn'>ğŸ”” Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğ¸ ÑƒĞ²Ñ–Ğ´Ğ°Ğ¼Ğ»Ñ”Ğ½Ñ–Ñ</button> 
<div class='menuActions'>
<button id='logoutMenu' class='back'>Ğ’Ğ¸Ğ¹Ñ‚Ñ–</button>
<button id='backMenu' class='back'>â¬… ĞĞ°Ğ·Ğ°Ğ´ Ğ´Ğ¾ Ğ¼ĞµĞ½Ñ</button>
</div>
</div>

<div id='chatScreen' class='screen'>
<div class='topbar'>
<h2 id='chatTitle'></h2>
</div>
<div id='messages'></div>
<div id='input-area'>
<input type='text' id='messageInput' placeholder='ĞŸĞ†Ğ¨Ğ˜!!!'>
<button id='sendBtn'>â†’</button>
<button id='voiceMsgBtn'>ğŸ™ï¸</button>
</div>
<div class='emojiPicker' id='emojiPicker'>
<img src='zefasticker1.png'>
<img src='zefasticker2.png'>
<img src='zefasticker3.png'>
<img src='zefasticker4.png'>
<img src='zefasticker5.png'>
<img src='zefasticker6.png'>
<img src='zefasticker7.png'>
</div>
<div class='menuActions'>
<button id='backChat' class='back'>â¬… ĞĞ°Ğ·Ğ°Ğ´</button>
</div>
</div>

<div id='privateChatsScreen' class='screen' style='display:none;'>
Â  Â  <h2>ĞŸÑ€Ñ–Ğ²Ğ°Ñ‚Ğ½Ñ– Ñ‡Ğ°Ñ‚Ğ¸</h2>
Â  Â  <div id='privateChatsList' style='width:100%; flex: 1; overflow-y: auto;'></div>
Â  Â  <div class='menuActions'>
Â  Â  Â  Â  <button id='backPrivateChats' class='back'>â¬… ĞĞ°Ğ·Ğ°Ğ´</button>
Â  Â  </div>
</div>

<script type='module'>
import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js'
import { getDatabase, ref, set, push, get, child, onValue, update, remove } from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js'

const firebaseConfig={apiKey:'AIzaSyBp_RXjmWLfK0wX8sDb1d_VQogZgwzaNFA',authDomain:'zefagram.firebaseapp.com',databaseURL:'https://zefagram-default-rtdb.europe-west1.firebasedatabase.app',projectId:'zefagram',storageBucket:'zefagram.firebasestorage.app',messagingSenderId:'664999563847',appId:'1:664999563847:web:3051100a05bdb41dc59762',measurementId:'G-CFS89PSQNK'}
const app=initializeApp(firebaseConfig)
const db=getDatabase(app)
let currentUser=localStorage.getItem('currentUser')||null
let currentChat='public'
let peerConnections={},localStream=null,callRefs={}

const authScreen=document.getElementById('authScreen')
const menuScreen=document.getElementById('menuScreen')
const chatScreen=document.getElementById('chatScreen')
const privateChatsScreen=document.getElementById('privateChatsScreen')
const usernameInput=document.getElementById('username')
const passwordInput=document.getElementById('password')
const messagesDiv=document.getElementById('messages')
const chatTitle=document.getElementById('chatTitle')
const messageInput=document.getElementById('messageInput')
const menuGreeting=document.getElementById('menuGreeting')
const privateChatsList=document.getElementById('privateChatsList')

function formatTime(date){return date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate()+' '+date.getHours()+':'+String(date.getMinutes()).padStart(2,'0')}

async function register(){const u=usernameInput.value.trim();const p=passwordInput.value.trim();if(!u||!p)return alert('Ğ’Ğ²Ñ”Ğ´Ğ¸Ñ– ÑĞ·Ñ”Ñ€Ğ½Ğ°Ğ¼Ñ” Ñ– Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ');const s=await get(child(ref(db),'users/'+u));if(s.exists())return alert('Ğ¢Ğ°ĞºĞ¸Ğ¹ ÑĞ·Ñ”Ñ€ Ğ²Ğ¶Ğµ Ñ”');await set(ref(db,'users/'+u),{password:p, chats: {}});alert('Ğ¢Ğ¸ Ğ·Ğ°Ñ€ĞµĞ³Ğ°Ğ²ÑÑ!')}
async function login(){const u=usernameInput.value.trim();const p=passwordInput.value.trim();if(!u||!p)return alert('Ğ’Ğ²Ñ”Ğ´Ñ– ÑĞ·Ñ”Ñ€Ğ½Ğ°Ğ¼Ñ” Ñ– Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ');const s=await get(child(ref(db),'users/'+u));if(!s.exists()||s.val().password!==p)return alert('ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¸Ğ¹ ÑĞ·Ñ”Ñ€ Ñ–Ğ»Ñ– Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ');currentUser=u;localStorage.setItem('currentUser',u);showMenu(true)}

function showMenu(show){authScreen.style.display='none';menuScreen.style.display=show?'flex':'none';chatScreen.style.display='none';privateChatsScreen.style.display='none';if(show)menuGreeting.textContent=`ĞŸÑ€Ñ–Ğ²Ñ”Ñ‚, Ğ´ÑƒÑ€Ğ° ${currentUser}!`}

function getChatPath(){return currentChat === 'ĞĞ±Ñ‰Ñ–Ğ¹ Ñ‡Ğ°Ñ‚' ? 'messages/public' : 'messages/' + currentChat}

function renderMessage(msgSnapshot){
Â  Â  const msg = msgSnapshot.val();
Â  Â  const messageKey = msgSnapshot.key;
Â  Â Â 
Â  Â  const d=document.createElement('div');
Â  Â  d.className='message '+(msg.user===currentUser?'from-me':'from-others');
Â  Â  let text=msg.text;
Â  Â  if(msg.type==='sticker')text=`<img src='${msg.url}' style='width:50px;height:50px'>`;
Â  Â  else if(msg.type==='audio')text=`<audio controls src='${msg.url}'></audio>`;
Â  Â  else text=text.replace(/\*\*(.*?)\*\*/g,'<b>$1</b>').replace(/\*(.*?)\*/g,'<i>$1</i>').replace(/__(.*?)__/g,'<u>$1</u>').replace(/~~(.*?)~~/g,'<s>$1</s>').replace(/`(.*?)`/g,"<span style='font-family:monospace'>$1</span>");
Â  Â Â 
Â  Â  d.innerHTML=`<strong>${msg.user}</strong>: ${text} <small>(${msg.time})</small>`;
Â  Â Â 
Â  Â  if (msg.user === currentUser) {
Â  Â  Â  Â  d.ondblclick = () => deleteMessage(messageKey, msg.type);
Â  Â  }
Â  Â Â 
Â  Â  messagesDiv.appendChild(d);
Â  Â  messagesDiv.scrollTop=messagesDiv.scrollHeight
}

async function deleteMessage(messageKey, type) {
Â  Â  if (!currentUser) return;
Â  Â  if (confirm('Ğ£Ğ´Ğ°Ğ»Ñ–Ñ‚ÑŒ? Ğ„ÑĞ»Ñ– Ñ‚Ğ¸ ĞµÑ‚Ğ° Ğ·Ñ€Ğ¾Ğ±Ğ¸Ñˆ, Ñ‚Ğ¾ Ğ—Ñ”Ñ„Ğ°Ğ‘Ğ¾Ñ‚ Ğ²ÑĞµ Ğ¾Ğ´Ğ½Ğ¾ Ğ±ÑƒĞ´Ñ–Ñ‚ Ğ¿Ñ€Ğ°Ğ²Ñ–Ñ‚ÑŒ Ğ¼Ñ–Ñ€Ğ°Ğ¼!')) {
Â  Â  Â  Â  const chatPath = getChatPath();
Â  Â  Â  Â  await remove(ref(db, chatPath + '/' + messageKey));
Â  Â  }
}

function showChat(chat, partner=null){
Â  Â  currentChat=chat;
Â  Â  messagesDiv.innerHTML='';
Â  Â  authScreen.style.display='none';
Â  Â  menuScreen.style.display='none';
Â  Â  chatScreen.style.display='flex';
Â  Â  privateChatsScreen.style.display='none';
Â  Â  chatTitle.textContent=partner || chat;
Â  Â Â 
Â  Â  const chatRef=ref(db, getChatPath());
Â  Â  onValue(chatRef,snapshot=>{messagesDiv.innerHTML='';snapshot.forEach(c=>renderMessage(c))});
}

function logout(){localStorage.removeItem('currentUser');currentUser=null;authScreen.style.display='flex';menuScreen.style.display='none';chatScreen.style.display='none';privateChatsScreen.style.display='none'}

async function sendMessage(){
Â  Â  const t=messageInput.value.trim();
Â  Â  if(!t||!currentUser)return;
Â  Â Â 
Â  Â  push(ref(db, getChatPath()),{user:currentUser,text:t,time:formatTime(new Date()),type:'text'});
Â  Â  messageInput.value='';
}

async function sendSticker(url){
Â  Â  push(ref(db, getChatPath()),{user:currentUser,url,type:'sticker',time:formatTime(new Date())})
}

async function sendAudio(blob){
Â  Â  const chatPath = getChatPath();
Â  Â Â 
Â  Â  const CLOUDINARY_CLOUD_NAME = 'doylfteu4';Â 
Â  Â  const CLOUDINARY_UPLOAD_PRESET = 'zefagram_audio';Â 

Â  Â  const formData = new FormData();
Â  Â  formData.append('file', blob, 'audio.webm');
Â  Â  formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
Â  Â Â 
Â  Â  let url = '';

Â  Â  try {
Â  Â  Â  Â  const response = await fetch(
Â  Â  Â  Â  Â  Â  `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/upload`,
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  );
Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  if (data.secure_url) {
Â  Â  Â  Â  Â  Â  url = data.secure_url;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.error('Cloudinary Response:', data);
Â  Â  Â  Â  Â  Â  throw new Error('ĞÑˆĞ¸Ğ±ĞºĞ°, Ğ¿Ñ–ÑˆĞ¸ Ua3012dima30: ' + (data.error ? data.error.message : 'Ğ¨Ğ¾?'));
Â  Â  Â  Â  }
Â  Â  } catch(e) {
Â  Â  Â  Â  alert('Ğ›Ğ¾Ñ…, ĞµÑ‚Ğ° Ğ·Ğ½Ğ°Ñ‡Ñ–Ñ‚ ÑˆĞ¾ Ğ½ÑƒĞ¶Ğ¸Ğ½ Ğ½Ğ¾Ñ€Ğ¼ Ñ–Ğ½ĞµÑ‚: ' + e.message);
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  push(ref(db, chatPath),{user:currentUser,url,type:'audio',time:formatTime(new Date())});
}

async function showPrivateChats() {
Â  Â  if (!currentUser) return;
Â  Â  showScreen('privateChatsScreen');
Â  Â Â 
Â  Â  const userChatsRef = ref(db, 'users/' + currentUser + '/chats');
Â  Â  onValue(userChatsRef, (snapshot) => {
Â  Â  Â  Â  privateChatsList.innerHTML = '';
Â  Â  Â  Â  if (snapshot.exists()) {
Â  Â  Â  Â  Â  Â  const chats = snapshot.val();
Â  Â  Â  Â  Â  Â  for (const chatID in chats) {
Â  Â  Â  Â  Â  Â  Â  Â  const partner = chats[chatID].partner;
Â  Â  Â  Â  Â  Â  Â  Â  const d = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  d.className = 'privateChatLink';
Â  Â  Â  Â  Â  Â  Â  Â  d.textContent = `Ğ‘Ğ°Ğ·Ğ°Ñ€ Ğ·: ${partner}`;
Â  Â  Â  Â  Â  Â  Â  Â  d.onclick = () => showChat(chatID, partner);
Â  Â  Â  Â  Â  Â  Â  Â  privateChatsList.appendChild(d);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  privateChatsList.innerHTML = '<p style=\'text-align: center; margin-top: 20px;\'>ĞŸÑƒÑÑ‚Ğ°.</p>';
Â  Â  Â  Â  }
Â  Â  });
}

async function createPrivateChat() {
Â  Â  const partner = prompt('Ğ’Ğ²Ñ”Ğ´Ñ–Ñ‚Ñ” ÑĞ·Ñ”Ñ€Ğ½Ğ°Ğ¼Ñ” ÑĞ¿Ñ–Ğ²Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ½Ğ¸ĞºĞ°:');
Â  Â  if (!partner || partner === currentUser) return alert('ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¸Ğ¹ ÑĞ·Ñ”Ñ€Ğ½Ğ°Ğ¼Ñ”.');
Â  Â Â 
Â  Â  const partnerSnap = await get(child(ref(db), 'users/' + partner));
Â  Â  if (!partnerSnap.exists()) return alert('Ğ¢Ğ°ĞºĞ¾Ğ²Ğ° Ğ½ĞµĞ¼Ğ°!.');
Â  Â Â 
Â  Â  const chatUsers = [currentUser, partner].sort();
Â  Â  const chatID = 'private_' + chatUsers[0] + '_' + chatUsers[1];
Â  Â Â 
Â  Â  const updates = {};
Â  Â  updates['/users/' + currentUser + '/chats/' + chatID] = { partner: partner };
Â  Â  updates['/users/' + partner + '/chats/' + chatID] = { partner: currentUser };

Â  Â  await update(ref(db), updates);
Â  Â  alert(`Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾ Ğ±Ğ°Ğ·Ğ°Ñ€ Ğ· ${partner}!`);
Â  Â  showChat(chatID, partner);
}

function showScreen(screenId) {
Â  Â  const screens = [authScreen, menuScreen, chatScreen, privateChatsScreen];
Â  Â  screens.forEach(screen => {
Â  Â  Â  Â  screen.style.display = (screen.id === screenId) ? 'flex' : 'none';
Â  Â  });
}

function requestNotificationPermission() {
    if (!('Notification' in window)) {
        alert('Ğ‘Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ½Ğµ Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ” ÑƒĞ²Ñ–Ğ´Ğ°Ğ¼Ğ»Ñ”Ğ½Ñ–Ñ!');
        return;
    }
    
    if (Notification.permission === 'granted') {
        alert('Ğ£Ğ²Ñ–Ğ´Ğ°Ğ¼Ğ»Ñ”Ğ½Ñ–Ñ Ğ²Ğ¶Ğµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ–.');
        return;
    }

    Notification.requestPermission().then(permission => {
        if (permission === 'granted') {
            alert('Ğ£Ğ²Ñ–Ğ´Ğ°Ğ¼Ğ»Ñ”Ğ½Ñ–Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ–! Ğ›Ğ¾Ñ… Ğ½Ğµ Ğ»Ğ¾Ñ…!');
        } else {
            alert('ĞĞµ Ğ²ĞºĞ»ÑÑ‡Ğ¸Ğ² ÑƒĞ²Ñ–Ğ´Ğ°Ğ¼Ğ»Ñ”Ğ½Ñ–Ñ. ĞÑƒ ÑˆĞ¾ Ñ‚Ğ¸ ÑĞº Ğ½Ğµ Ğ»Ğ¾Ñ…, Ğ½Ğµ Ğ»Ğ¾Ñ…?');
        }
    });
}


document.querySelectorAll('#emojiPicker img').forEach(i=>i.onclick=e=>sendSticker(e.target.src))

document.getElementById('registerBtn').onclick=register
document.getElementById('loginBtn').onclick=login
document.getElementById('backMenu').onclick=()=>window.location.href='https://ua3012.github.io/ZefaApps/index.html'
document.getElementById('logoutMenu').onclick=logout
document.getElementById('backChat').onclick=()=>showMenu(true)
document.getElementById('backAuth').onclick=()=>window.location.href='https://ua3012.github.io/ZefaApps/index.html'
document.getElementById('publicChatBtn').onclick=()=>showChat('ĞĞ±Ñ‰Ñ–Ğ¹ Ñ‡Ğ°Ñ‚')
document.getElementById('sendBtn').onclick=sendMessage

document.getElementById('privateChatsBtn').onclick=showPrivateChats;
document.getElementById('createPrivateBtn').onclick=createPrivateChat;
document.getElementById('backPrivateChats').onclick=()=>showMenu(true);
document.getElementById('enableNotificationsBtn').onclick = requestNotificationPermission;


let mediaRecorder
let mediaStream = null;

document.getElementById('voiceMsgBtn').onclick=async()=>{
Â  Â  if(!currentUser) return alert('Ğ’Ğ²Ğ°Ğ¹Ğ´Ñ–, ÑˆĞ¾Ğ± Ğ±Ğ°Ğ·Ğ°Ñ€Ñ–Ñ‚ÑŒ!');

Â  Â  const voiceBtnElement = document.getElementById('voiceMsgBtn');

Â  Â  if(mediaRecorder && mediaRecorder.state === 'recording'){
Â  Â  Â  Â  mediaRecorder.stop();
Â  Â  Â  Â  voiceBtnElement.classList.remove('active');
Â  Â  Â  Â  return
Â  Â  }

Â  Â  try {
Â  Â  Â  Â  if (!mediaStream) {
Â  Â  Â  Â  Â  Â  mediaStream = await navigator.mediaDevices.getUserMedia({audio:true});
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  mediaRecorder = new MediaRecorder(mediaStream);
Â  Â  Â  Â  voiceBtnElement.classList.add('active');
Â  Â  Â  Â Â 
Â  Â  Â  Â  let chunks=[]
Â  Â  Â  Â  mediaRecorder.ondataavailable=e=>chunks.push(e.data)
Â  Â  Â  Â Â 
Â  Â  Â  Â  mediaRecorder.onstop=e=>{
Â  Â  Â  Â  Â  Â  if (mediaStream) {
Â  Â  Â  Â  Â  Â  Â  Â  mediaStream.getTracks().forEach(track => track.stop());
Â  Â  Â  Â  Â  Â  Â  Â  mediaStream = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(chunks.length > 0) sendAudio(new Blob(chunks,{type:'audio/webm'}));
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  mediaRecorder.start();
Â  Â  } catch(e) {
Â  Â  Â  Â  alert('Ğ¨Ğ¾ Ğ· Ğ¼Ñ–ĞºĞ¾Ğ¼: ' + e.message)
Â  Â  Â  Â  voiceBtnElement.classList.remove('active');
Â  Â  }
}

window.onload=()=>{if(currentUser)showMenu(true);else authScreen.style.display='flex'}
</script>
</body>
</html>
