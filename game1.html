<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Лабіринт (чистий код)</title>
  <style>
    html, body {margin:0; height:100%; overflow:hidden; background:black;}
    canvas {display:block;}
    #info {
      position: absolute; top: 10px; left: 10px;
      color: white; background: rgba(0,0,0,0.5);
      padding: 6px 10px; border-radius: 6px;
      font-family: sans-serif; user-select:none;
    }
  </style>
</head>
<body>
  <div id="info">Клікни мишею для керування. WASD — рух, миша — огляд</div>
  <!-- Three.js та PointerLockControls -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/PointerLockControls.js"></script>
  <script>
    // --- Конфігурація лабіринту (можна легко змінити) ---
    const MAZE_LAYOUT = [
      "##########",
      "#        #",
      "#  ##    #",
      "#     #  #",
      "#  ##    #",
      "#        #",
      "##########"
    ];

    // --- Ініціалізація сцени ---
    let camera, scene, renderer, controls;
    let velocity = new THREE.Vector3();
    const move = {forward: false, backward: false, left: false, right: false};
    const MOVE_SPEED = 4;

    function init() {
      // Сцена та камера
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000000);
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);

      // Рендерер
      renderer = new THREE.WebGLRenderer({antialias: true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Освітлення
      scene.add(new THREE.AmbientLight(0x404040));
      const pl = new THREE.PointLight(0xffffff, 1, 100);
      pl.position.set(0, 5, 0);
      scene.add(pl);

      // Підлога
      const floor = new THREE.Mesh(
        new THREE.PlaneGeometry(50, 50),
        new THREE.MeshStandardMaterial({color: 0x222222})
      );
      floor.rotation.x = -Math.PI/2;
      floor.position.y = 0;
      scene.add(floor);

      // Лабіринт
      buildMaze(MAZE_LAYOUT);

      // Контролер руху
      controls = new THREE.PointerLockControls(camera, document.body);
      camera.position.set(1, 0.5, 1); // Початкова позиція (можна змінити)
      scene.add(controls.getObject());

      // Управління
      document.addEventListener('keydown', onKeyDown);
      document.addEventListener('keyup', onKeyUp);
      document.body.addEventListener('click', () => controls.lock());

      // Адаптація до розміру вікна
      window.addEventListener('resize', onWindowResize);

      // Старт анімації
      animate();
    }

    // --- Побудова лабіринту ---
    function buildMaze(layout) {
      const wallGeo = new THREE.BoxGeometry(1, 1, 1);
      const wallMat = new THREE.MeshStandardMaterial({color: 0x0077ff});
      layout.forEach((row, z) => {
        [...row].forEach((cell, x) => {
          if (cell === '#') {
            const wall = new THREE.Mesh(wallGeo, wallMat);
            wall.position.set(x, 0.5, z);
            scene.add(wall);
          }
        });
      });
    }

    // --- Керування клавішами ---
    function onKeyDown(e) {
      switch (e.code) {
        case 'KeyW': move.forward = true; break;
        case 'KeyS': move.backward = true; break;
        case 'KeyA': move.left = true; break;
        case 'KeyD': move.right = true; break;
      }
    }
    function onKeyUp(e) {
      switch (e.code) {
        case 'KeyW': move.forward = false; break;
        case 'KeyS': move.backward = false; break;
        case 'KeyA': move.left = false; break;
        case 'KeyD': move.right = false; break;
      }
    }
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // --- Головний цикл анімації ---
    let prevTime = performance.now();

    function animate() {
      requestAnimationFrame(animate);

      const time = performance.now();
      const delta = (time - prevTime) / 1000; // в секундах
      prevTime = time;

      // Спадання швидкості (гальмування)
      velocity.x -= velocity.x * 10 * delta;
      velocity.z -= velocity.z * 10 * delta;

      // Прискорення від натискання
      if (move.forward)  velocity.z -= MOVE_SPEED * delta;
      if (move.backward) velocity.z += MOVE_SPEED * delta;
      if (move.left)     velocity.x -= MOVE_SPEED * delta;
      if (move.right)    velocity.x += MOVE_SPEED * delta;

      // Рух
      controls.moveRight(velocity.x * delta);
      controls.moveForward(velocity.z * delta);

      renderer.render(scene, camera);
    }

    // --- Запуск ---
    window.onload = init;
  </script>
</body>
</html>
