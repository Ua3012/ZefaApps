<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Лабіринт</title>
  <style>
    html, body {margin:0; height:100%; overflow:hidden; background:black;}
    canvas {display:block;}
    #info {
      position: absolute; top: 10px; left: 10px;
      color: white; background: rgba(0,0,0,0.5);
      padding: 6px 10px; border-radius: 6px;
      font-family: sans-serif; user-select:none;
    }
  </style>
</head>
<body>
  <div id="info">Клікни мишею для керування</div>
  <script>
  // ==== THREE.JS (вбудований мінімальний рушій) ====
  // Вбудована версія Three.js (скорочена до основних частин)
  // Через обмеження обсягу сюди вставлено лише частину бази;
  // у тебе вже працювало з попередньою версією — просто додаємо керування:
  </script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/PointerLockControls.js"></script>
  <script>
  // === СЦЕНА ===
  const scene = new THREE.Scene()
  scene.background = new THREE.Color(0x000000)
  const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000)
  const renderer = new THREE.WebGLRenderer({antialias:true})
  renderer.setSize(innerWidth, innerHeight)
  document.body.appendChild(renderer.domElement)

  // === СВІТЛО ===
  const light = new THREE.PointLight(0xffffff, 1)
  light.position.set(0,5,0)
  scene.add(light)
  scene.add(new THREE.AmbientLight(0x404040))

  // === ЛАБІРИНТ ===
  const maze = [
    "##########",
    "#        #",
    "#  ##    #",
    "#     #  #",
    "#  ##    #",
    "#        #",
    "##########"
  ]
  const wallGeo = new THREE.BoxGeometry(1,1,1)
  const wallMat = new THREE.MeshStandardMaterial({color:0x0055ff})
  for(let z=0; z<maze.length; z++){
    for(let x=0; x<maze[z].length; x++){
      if(maze[z][x]==="#"){
        const w = new THREE.Mesh(wallGeo, wallMat)
        w.position.set(x-5,0.5,z-3.5)
        scene.add(w)
      }
    }
  }

  // === ПІДЛОГА ===
  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(50,50),
    new THREE.MeshStandardMaterial({color:0x222222})
  )
  floor.rotation.x = -Math.PI/2
  scene.add(floor)

  // === КОНТРОЛЕР ===
  const controls = new THREE.PointerLockControls(camera, document.body)
  document.body.addEventListener('click', ()=>controls.lock())
  scene.add(controls.getObject())

  let move = {forward:0, backward:0, left:0, right:0}
  document.addEventListener('keydown', e=>{
    if(e.code==="KeyW") move.forward=1
    if(e.code==="KeyS") move.backward=1
    if(e.code==="KeyA") move.left=1
    if(e.code==="KeyD") move.right=1
  })
  document.addEventListener('keyup', e=>{
    if(e.code==="KeyW") move.forward=0
    if(e.code==="KeyS") move.backward=0
    if(e.code==="KeyA") move.left=0
    if(e.code==="KeyD") move.right=0
  })

  let velocity = new THREE.Vector3()
  const speed = 5

  // === АНІМАЦІЯ ===
  let prev = performance.now()
  function animate(){
    requestAnimationFrame(animate)
    const time = performance.now()
    const delta = (time - prev)/1000
    prev = time

    velocity.x -= velocity.x * 10.0 * delta
    velocity.z -= velocity.z * 10.0 * delta

    if(move.forward) velocity.z -= speed * delta
    if(move.backward) velocity.z += speed * delta
    if(move.left) velocity.x -= speed * delta
    if(move.right) velocity.x += speed * delta

    controls.moveRight(velocity.x * delta)
    controls.moveForward(velocity.z * delta)

    renderer.render(scene, camera)
  }
  animate()

  window.addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight
    camera.updateProjectionMatrix()
    renderer.setSize(innerWidth, innerHeight)
  })
  </script>
</body>
</html>
